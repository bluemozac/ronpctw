//===== rAthena Script =======================================
//= Instances: A Gathering Place of Wolves and Sanctuary Purification.
//===== Description: =========================================
//- [Walkthrough conversion]
//- A Gathering Place of Wolves is a part of the episode 18.1 main quest.
//- Sanctuary Purification is a daily quest.
//===== Changelogs: ==========================================
//= 1.0 First version. [Capuche]
//============================================================

// Main Quest: Step 54. (entrance npc is a part of the instance A Gathering Place of Wolves)
rachel,167,244,5	duplicate(dummy_cloaked_npc)	Suad#sms03	4_EP18_SUAD

rachel,169,245,3	script	Ordinary person#sms04	4_EP18_GW_WOMAN01,{
	if (ep18_1_main < 50) {
		end;
	}
	if (ep18_1_main == 50 || ep18_1_main == 51) {	// 17519 == 1
		mes "[常人]";
		mes "這個地方正在維修中，禁止進入。";
		next;
		cutin "ep18_Suad_01.png",2;
		cloakoffnpcself( "Suad#sms03" );
		mes "[法庭]";
		mes "您不必保持警惕。這個冒險家與我們同在。";
		next;
		cutin "ep18_miriam_01.png",0;
		cloakoffnpcself( "Miriam#sms03" );
		mes "[米麗亞姆]";
		mes "你們都在這裡嗎？";
		next;
		cutin "ep18_Suad_01.png",2;
		mes "[法庭]";
		mes "是的。準備工作已經完成。只需向我們的人民發出信號並進入聖殿。";
		next;
		cutin "ep18_miriam_01.png",0;
		mes "[米麗亞姆]";
		mes "我必須快速移動。";
		next;
		cutin "ep18_Suad_01.png",2;
		mes "[法庭]";
		mes "如果您進入這裡，則可以通過寺廟的側門進入。冒險家，您想現在進入嗎？";
		next;
		
		.@md_name$ = "A Gathering Place of Wolves";

		// player has party
		if (is_party_leader()) {
			// player is leader of the party
			.@create$ = "Create " + .@md_name$;
		}

		switch( select(.@create$, "進入。", "我需要時間。" ) ) {
		case 1:
			if (instance_create(.@md_name$) < 0) {	// Note: not forced solo
				mes "派對：" + getpartyname(getcharid(1)) + "";
				mes "領導者：" + strcharinfo(0) + "";
				mes "^0000ff" + .@md_name$ + " ^000000- Unknown error";
				close3;
			}
			mes "[Miriam偽裝]";
			mes "您最好等一下。";
			close3;
		case 2:
			switch( instance_enter(.@md_name$) ) {
			case IE_OTHER:
				mes "[法庭]";
				mes "^ff0000an發生了未知錯誤。 ^000000";
				close3;
			case IE_NOINSTANCE:
				mes "[法庭]";
				mes "告訴黨的領導人準備就緒時發送信號。";
				close3;
			case IE_NOMEMBER:
				mes "[法庭]";
				mes "^ff0000laly of該黨的成員可以進入紀念地牢。 ^000000";
				close3;
			case IE_OK:
				mes "[法庭]";
				mes "信號在這裡，所以繼續前進。我們走吧。";
				if (ep18_1_main == 50) {
					changequest 17519,17520;
					ep18_1_main = 51;
				}
				cutin "",255;
				mapannounce "rachel", "" + strcharinfo(0) + " of the party, " + getpartyname( getcharid(1) ) + ", is entering " + .@md_name$ + ".",bc_map,"0x00ff99",FW_NORMAL,12;
				// warp "1@nyr",194,30;
				close;
			}
			end;
		case 3:
			close3;
		}
		end;
	}
	mes "[常人]";
	mes "一個來自寺廟的人在等你。";
	close2;
	cloakoffnpcself( "Miriam#sms03" );
	npctalk "歡迎先生。", "Miriam#sms03", bc_self;
	end;

OnInit:
	questinfo( QTYPE_QUEST, QMARK_YELLOW, "isbegin_quest(17519) == 1" );

	// Sanctuary Purification
	questinfo( QTYPE_DAILYQUEST, QMARK_YELLOW, "checkquest(17527,PLAYTIME) == 2" );
	questinfo( QTYPE_DAILYQUEST, QMARK_YELLOW, "ep18_1_main >= 52 && checkquest(17527,PLAYTIME) == -1 && isbegin_quest(17522) == 0 && isbegin_quest(17523) == 0" );
	end;
}

// Instance Sanctuary Purification entrance
rachel,167,242,7	script(CLOAKED)	Miriam#sms03	4_EP18_MIRIAM,{
	if (checkweight(1000405,4) == 0) {
		mes "- 等一下 ！ ！ -";
		mes "- 目前您正在攜帶 -";
		mes "- 與您在一起太多。 -";
		mes "- 請重試 -";
		mes "- 減輕體重後。 -";
		close;
	}
	.@md_name$ = "Sanctuary Purification";
	if (ep18_1_main >= 52) {	// repeatable instance Sanctuary Purification
		if (BaseLevel < 170) {
			mes "[牧師]";
			mes "在這種情況下，您必須至少是Baselevel 170。";
			close;
		}
		if (isbegin_quest(17524) == 1 || isbegin_quest(17526) == 1) {
			mes "[牧師]";
			mes "歡迎回來，冒險家。你努力工作。";
			if (isbegin_quest(17524) == 1) {
				erasequest 17524;
				.@count = 2;
			}
			if (isbegin_quest(17526) == 1) {
				erasequest 17526;
				.@count += 2;
			}
			getitem 1000405,.@count;	// Ep18_Amethyst_Fragment
			close;
		}
		switch( checkquest(17527,PLAYTIME) ) {
		case -1:
			if (isbegin_quest(17522) == 0 && isbegin_quest(17523) == 0)
				callsub( S_Take, 0 );
			break;
		case 0:
		case 1:
			mes "[jin睾丸]";
			mes "請等待任務延遲的結尾。";
			close;
		case 2:
			mes "[牧師]";
			mes "你好！你休息了嗎？如果您今天能幫助我，我會很感激。請注意，操作可以每天完成一次。";
			erasequest 17527;
			if (isbegin_quest(17522) == 0 && isbegin_quest(17523) == 0)
				callsub( S_Take, 1 );
			break;
		}
		mes "[牧師]";
		mes "你準備好了嗎？我會向您發送一個信號。";
		next;
		switch( select("嘿，發出信號", "我會進入。", "我有一個任務還沒有接到！", "我需要更多的準備。" ) ) {
		case 1:
			mes "[牧師]";
			mes "您已經得到了接線點。如果您經過此緊急出口，則可以立即加入。準備就緒時輸入。";
			if (instance_create(.@md_name$) < 0) {
				mes "派對：" + getpartyname(getcharid(1)) + "";
				mes "領導者：" + strcharinfo(0) + "";
				mes "^0000ff" + .@md_name$ + " ^000000- Unknown error";
				close;
			}
			end;
		case 2:
			switch( instance_enter(.@md_name$) ) {
			case IE_OTHER:
				mes "^ff0000an發生了未知錯誤。 ^000000";
				close;
			case IE_NOINSTANCE:
				mes "紀念地牢不存在。";
				mes "黨的領導人尚未產生地牢。";
				close;
			case IE_NOMEMBER:
				mes "^ff0000laly of該黨的成員可以進入紀念地牢。 ^000000";
				close;
			case IE_OK:
				mes "[牧師]";
				mes "信號在這裡，所以讓我們繼續前進。讓我們直接去交界處。";
				mapannounce "rachel", "" + strcharinfo(0) + " of the party, " + getpartyname( getcharid(1) ) + ", is entering " + .@md_name$ + ".",bc_map,"0x00ff99",FW_NORMAL,12;
				setquest 17527;
				// warp "1@nyr",194,30;
				end;
			}
			end;
		case 3:
			callsub( S_Take, 0 );
		case 4:
			end;
		}
	}
	end;

S_Take:
	if (getarg(0) == 0) {
		mes "[jin睾丸]";
		mes "滲透到聖殿的主要力量已經消失了，但是落在心臟獵人一側的聖殿後衛和瞄準心臟的心臟獵人的殘餘物仍然是一個問題。";
		next;
		mes "[jin睾丸]";
		mes "我們正在自己的牆壁上工作，但是如果冒險家會提供幫助，我們將不勝感激。請注意，清算操作每天進行一次。";
	}
	next;
	switch( select("這兩個任務。", "清除叛變的聖殿守衛", "獵心者索堂", "一定很難" ) ) {
	case 1:
		if (isbegin_quest(17522) == 0 && isbegin_quest(17524) == 0)
			setquest 17522;
		if (isbegin_quest(17523) == 0 && isbegin_quest(17526) == 0)
			setquest 17523;
		mes "[牧師]";
		mes "太感謝了。然後告訴我你什麼時候準備就緒。";
		close;
	case 2:
		if (isbegin_quest(17522) == 0 && isbegin_quest(17524) == 0)
			setquest 17522;
		mes "[牧師]";
		mes "太感謝了。然後告訴我你什麼時候準備就緒。";
		close;
	case 3:
		if (isbegin_quest(17523) == 0 && isbegin_quest(17526) == 0)
			setquest 17523;
		mes "[牧師]";
		mes "太感謝了。然後告訴我你什麼時候準備就緒。";
		close;
	case 4:
		end;
	}
	end;
}


// Define the instance variables and disable the unused NPCs
1@nyr,1,1,0	script	nyr_starter	-1,{
	end;
OnInstanceInit:
	'nyr_main_step = 0;
	'nyr_daily_step = 0;
	'code = 0;
	'map_1nyr$ = instance_mapname("1@nyr");
	'map_2nyr$ = instance_mapname("2@nyr");

	if (instance_live_info(ILI_NAME) == "A Gathering Place of Wolves") {	// Gathering Place of Wolves instance : disable the stater NPCs of Sanctuary Purification
		disablenpc instance_npcname("#qar101sw");

		for ( .@i = 1; .@i < 16; ++.@i ) {
			if (.@i < 10)
				.@string$ = "0" + .@i;
			else
				.@string$ = "" + .@i;
			disablenpc instance_npcname("#cell" + .@string$);
		}
		disablenpc instance_npcname("#cell42");
		disablenpc instance_npcname("#cell51");
		disablenpc instance_npcname("#cell66");
		
		// disablenpc instance_npcname("#cell41");	// duplicate of 8
		disablenpc instance_npcname("#qmobg101");
	}
	else {	// Sanctuary Purification instance : disable the stater NPCs of A Gathering Place of Wolves
		// Step 1 - Gathering Place of Wolves
		disablenpc instance_npcname("Miriam#dms101");
		disablenpc instance_npcname("Suad#dms101");
		disablenpc instance_npcname("Ramachus#dms102");
		disablenpc instance_npcname("Kun#dms112");
		disablenpc instance_npcname("Yoppi#dms122");
		disablenpc instance_npcname("Angry Crowd#dms171");
		disablenpc instance_npcname("Temple Guard#dms101");
		disablenpc instance_npcname("Temple Guard#dms111");
		disablenpc instance_npcname("Temple Guard#dms121");
		disablenpc instance_npcname("Temple Guard#dms131");
		disablenpc instance_npcname("Temple Guard#dms141");
		disablenpc instance_npcname("Temple Guard#dms151");
		disablenpc instance_npcname("Temple Guard#dms181");
		disablenpc instance_npcname("Temple Guard#dms191");
		disablenpc instance_npcname("Angry Crowd#dms101");
		disablenpc instance_npcname("Angry Crowd#dms111");
		disablenpc instance_npcname("Angry Crowd#dms121");
		disablenpc instance_npcname("Angry Crowd#dms131");
		disablenpc instance_npcname("Angry Crowd#dms141");
		disablenpc instance_npcname("Angry Crowd#dms151");
		disablenpc instance_npcname("Angry Crowd#dms161");
		disablenpc instance_npcname("Angry Crowd#dms181");
		disablenpc instance_npcname("Angry Crowd#dms191");
		
		// walls
		setcell 'map_1nyr$,89,24,89,153,cell_walkable,0;
		setcell 'map_1nyr$,150,24,150,153,cell_walkable,0;
	}

	// Sanctuary Purification instance - 1@nyr
	disablenpc instance_npcname("Temple Guard#qdms01");
	disablenpc instance_npcname("Temple Guard#qdms02");
	disablenpc instance_npcname("Temple Guard#qdms03");
	disablenpc instance_npcname("Temple Guard#qdms21");
	disablenpc instance_npcname("Temple Guard#qdms22");
	disablenpc instance_npcname("Temple Guard#qdms23");
	disablenpc instance_npcname("Temple Guard#qdms31");
	disablenpc instance_npcname("Temple Guard#qdms32");
	disablenpc instance_npcname("Temple Guard#qdms33");
	disablenpc instance_npcname("Temple Guard#qdms41");
	disablenpc instance_npcname("Temple Guard#qdms42");

	// disablenpc instance_npcname("#qmobg401");
	// disablenpc instance_npcname("#qar201sw");

	// warps
	disablenpc instance_npcname("#qwpto01");
	disablenpc instance_npcname("#qwpto02");
	disablenpc instance_npcname("#qwpto03");
	disablenpc instance_npcname("#areaw03");

	// disablenpc instance_npcname("#qwptora");	// unknown

	disablenpc instance_npcname("Temple Guard#qdms101");
	disablenpc instance_npcname("Temple Guard#qdms111");
	disablenpc instance_npcname("Temple Guard#qdms121");
	disablenpc instance_npcname("Temple Guard#qdms131");
	disablenpc instance_npcname("Temple Guard#qdms141");
	disablenpc instance_npcname("Temple Guard#qdms151");
	disablenpc instance_npcname("Temple Guard#qdms161");
	disablenpc instance_npcname("Temple Guard#qdms171");
	disablenpc instance_npcname("Temple Guard#qdms181");
	disablenpc instance_npcname("Temple Guard#qdms102");
	disablenpc instance_npcname("Temple Guard#qdms112");
	disablenpc instance_npcname("Temple Guard#qdms122");
	disablenpc instance_npcname("Temple Guard#qdms132");
	disablenpc instance_npcname("Temple Guard#qdms142");
	disablenpc instance_npcname("Temple Guard#qdms152");
	disablenpc instance_npcname("Temple Guard#qdms162");
	disablenpc instance_npcname("Temple Guard#qdms172");
	disablenpc instance_npcname("Temple Guard#qdms182");

	// Step 2 - Gathering Place of Wolves
	disablenpc instance_npcname("Miriam#dms201");
	disablenpc instance_npcname("Temple Guard#dms201");
	disablenpc instance_npcname("Temple Guard#dms211");
	disablenpc instance_npcname("Temple Guard#dms221");
	disablenpc instance_npcname("Temple Guard#dms231");
	disablenpc instance_npcname("Temple Guard#dms241");
	disablenpc instance_npcname("#msna01");

	// Step 3 - Gathering Place of Wolves
	disablenpc instance_npcname("Miriam#dms301");
	disablenpc instance_npcname("Ramachus#dms201");
	disablenpc instance_npcname("Yoppi#dms221");
	disablenpc instance_npcname("Kun#dms211");
	disablenpc instance_npcname("Temple Guard#dms301");
	disablenpc instance_npcname("Temple Guard#dms311");
	disablenpc instance_npcname("Temple Guard#dms321");
	disablenpc instance_npcname("Temple Guard#dms331");
	disablenpc instance_npcname("Temple Guard#dms341");

	// Step 4 - Gathering Place of Wolves
	disablenpc instance_npcname("Miriam#dms401");
	disablenpc instance_npcname("Ramachus#dms301");
	disablenpc instance_npcname("Kun#dms311");
	disablenpc instance_npcname("Yoppi#dms321");
	disablenpc instance_npcname("Temple Guard#dms401");
	disablenpc instance_npcname("Temple Guard#dms411");
	disablenpc instance_npcname("Temple Guard#dms421");
	disablenpc instance_npcname("Temple Guard#dms431");
	disablenpc instance_npcname("Temple Guard#dms441");

	// Step 5 - Gathering Place of Wolves
	disablenpc instance_npcname("Miriam#dms501");
	disablenpc instance_npcname("Ramachus#dms401");
	disablenpc instance_npcname("Kun#dms411");
	disablenpc instance_npcname("Yoppi#dms421");
	disablenpc instance_npcname("Shulang#dms101");
	disablenpc instance_npcname("Temple Guard#dms501");
	disablenpc instance_npcname("Temple Guard#dms511");
	disablenpc instance_npcname("Temple Guard#dms521");
	disablenpc instance_npcname("Temple Guard#dms531");
	disablenpc instance_npcname("Temple Guard#dms541");

	// Step 6 - Gathering Place of Wolves
	// disablenpc instance_npcname("#dmss101");
	disablenpc instance_npcname("Miriam#dms601");
	disablenpc instance_npcname("Ramachus#dms501");
	disablenpc instance_npcname("Kun#dms511");
	disablenpc instance_npcname("Yoppi#dms521");
	disablenpc instance_npcname("Shulang#dms201");
	disablenpc instance_npcname("Bagot#dms101");
	disablenpc instance_npcname("Private Officer#dms101");
	disablenpc instance_npcname("Temple Guard#dms601");
	disablenpc instance_npcname("Temple Guard#dms611");
	disablenpc instance_npcname("Temple Guard#dms621");
	disablenpc instance_npcname("#effc01");

	// Step 7 + 8 - Gathering Place of Wolves
	// disablenpc instance_npcname("#dms701");
	disablenpc instance_npcname("Miriam#dms701");
	disablenpc instance_npcname("Ramachus#dms601");
	disablenpc instance_npcname("Kun#dms611");
	disablenpc instance_npcname("Yoppi#dms621");
	disablenpc instance_npcname("Niren#dms101");
	disablenpc instance_npcname("Private Officer#dms201");
	disablenpc instance_npcname("Bagot#dms201");
	disablenpc instance_npcname("Shulang#dms301");
	disablenpc instance_npcname("Temple Guard#dms701");
	disablenpc instance_npcname("Temple Guard#dms711");
	disablenpc instance_npcname("Temple Guard#dms721");
	disablenpc instance_npcname("Temple Guard#dms731");
	disablenpc instance_npcname("Temple Guard#dms741");
	disablenpc instance_npcname("Temple Guard#dms751");
	disablenpc instance_npcname("Temple Guard#dms761");
	disablenpc instance_npcname("Temple Guard#dms771");

	// Step 9 - Gathering Place of Wolves
	disablenpc instance_npcname("#dmswch02");
	disablenpc instance_npcname("Miriam#dms801");

	// Step 10 - Gathering Place of Wolves
	disablenpc instance_npcname("Suad#dms102");

	disablenpc instance_npcname("Zhed#dms101");
	disablenpc instance_npcname("Niren#dms201");

	disablenpc instance_npcname("Temple Guard#dms802");
	disablenpc instance_npcname("Temple Guard#dms812");
	disablenpc instance_npcname("Temple Guard#dms822");
	disablenpc instance_npcname("Temple Guard#dms832");
	disablenpc instance_npcname("Temple Guard#dms842");

	disablenpc instance_npcname("Temple Guard#dms801");
	disablenpc instance_npcname("Temple Guard#dms811");
	disablenpc instance_npcname("Temple Guard#dms821");
	disablenpc instance_npcname("Temple Guard#dms831");
	disablenpc instance_npcname("Temple Guard#dms841");
	disablenpc instance_npcname("Temple Guard#dms851");
	disablenpc instance_npcname("Temple Guard#dms861");
	disablenpc instance_npcname("Temple Guard#dms871");
	disablenpc instance_npcname("Temple Guard#dms881");
	disablenpc instance_npcname("Temple Guard#dms891");

	disablenpc instance_npcname("Heart Hunter#dms101");
	disablenpc instance_npcname("Heart Hunter#dms111");
	disablenpc instance_npcname("Heart Hunter#dms121");
	disablenpc instance_npcname("Heart Hunter#dms131");
	disablenpc instance_npcname("Heart Hunter#dms141");
	disablenpc instance_npcname("Heart Hunter#dms151");
	disablenpc instance_npcname("Heart Hunter#dms161");
	disablenpc instance_npcname("Heart Hunter#dms171");
	disablenpc instance_npcname("Heart Hunter#dms181");
	disablenpc instance_npcname("Heart Hunter#dms191");

	disablenpc instance_npcname("Angry Crowd#dms201");
	disablenpc instance_npcname("Angry Crowd#dms211");
	disablenpc instance_npcname("Angry Crowd#dms221");
	disablenpc instance_npcname("Angry Crowd#dms231");
	disablenpc instance_npcname("Angry Crowd#dms241");
	disablenpc instance_npcname("Angry Crowd#dms251");
	disablenpc instance_npcname("Angry Crowd#dms261");
	disablenpc instance_npcname("Angry Crowd#dms271");
	disablenpc instance_npcname("Angry Crowd#dms281");
	disablenpc instance_npcname("Angry Crowd#dms291");

	disablenpc instance_npcname("Angry Crowd#dms202");
	disablenpc instance_npcname("Angry Crowd#dms212");
	disablenpc instance_npcname("Angry Crowd#dms222");
	disablenpc instance_npcname("Angry Crowd#dms232");
	disablenpc instance_npcname("Angry Crowd#dms242");

	// daily (2@nyr)
	disablenpc instance_npcname("Temple Guard#2dms221");
	disablenpc instance_npcname("Temple Guard#2dms231");
	disablenpc instance_npcname("Temple Guard#2dms241");
	disablenpc instance_npcname("#2mstep11");
	disablenpc instance_npcname("Temple Guard#2dms201");
	disablenpc instance_npcname("Temple Guard#2dms251");
	disablenpc instance_npcname("Temple Guard#2dms211");

	disablenpc instance_npcname("#2ar101sw");
	disablenpc instance_npcname("Temple Guard#2dms101");
	disablenpc instance_npcname("Temple Guard#2dms111");
	disablenpc instance_npcname("Temple Guard#2dms121");
	disablenpc instance_npcname("Temple Guard#2dms131");
	disablenpc instance_npcname("Temple Guard#2dms141");
	disablenpc instance_npcname("Temple Guard#2dms151");
	disablenpc instance_npcname("Temple Guard#2dms161");
	disablenpc instance_npcname("#2mstep01");
	disablenpc instance_npcname("#2mstep02");
	disablenpc instance_npcname("Security Device#2dms10");
	disablenpc instance_npcname("#2mstep03");
	disablenpc instance_npcname("#2mstep04");
	disablenpc instance_npcname("Security Device#2dms20");
	disablenpc instance_npcname("#2mstep05");
	disablenpc instance_npcname("#2mstep06");
	disablenpc instance_npcname("Security Device#2dms30");
	disablenpc instance_npcname("#2mstep07");
	disablenpc instance_npcname("#2mstep08");
	disablenpc instance_npcname("#2mstep09");
	disablenpc instance_npcname("Security Device#2dms40");
	disablenpc instance_npcname("#2mstep10");
	disablenpc instance_npcname("#msnavi01");
	disablenpc instance_npcname("Temple Guard#2dms261");

	disablenpc instance_npcname("#2ar201sw");
	disablenpc instance_npcname("Heart Hunter#2dms50");

	disablenpc instance_npcname("Heart Hunter#2dms10");
	disablenpc instance_npcname("Heart Hunter#2dms11");
	disablenpc instance_npcname("Heart Hunter#2dms12");
	disablenpc instance_npcname("Heart Hunter#2dms13");

	disablenpc instance_npcname("Heart Hunter#2dms20");
	disablenpc instance_npcname("Heart Hunter#2dms21");
	disablenpc instance_npcname("Heart Hunter#2dms22");

	disablenpc instance_npcname("Heart Hunter#2dms30");
	disablenpc instance_npcname("Heart Hunter#2dms31");
	disablenpc instance_npcname("Heart Hunter#2dms32");

	disablenpc instance_npcname("Heart Hunter#2dms40");
	disablenpc instance_npcname("Heart Hunter#2dms41");
	disablenpc instance_npcname("Heart Hunter#2dms42");
	disablenpc instance_npcname("Heart Hunter#2dms43");
	disablenpc instance_npcname("Heart Hunter#2dms44");
	disablenpc instance_npcname("Heart Hunter#2dms45");
	disablenpc instance_npcname("Heart Hunter#2dms46");
	disablenpc instance_npcname("Heart Hunter#2dms47");
	disablenpc instance_npcname("Heart Hunter#2dms48");
	disablenpc instance_npcname("Heart Hunter#2dms49");

	// warps
	disablenpc instance_npcname("#dmswp01");
	disablenpc instance_npcname("#dmwrp02");

	disablenpc instance_npcname("#mstep01");
	disablenpc instance_npcname("#mstep02");
	disablenpc instance_npcname("#mstep03");
	disablenpc instance_npcname("#mstep04");
	disablenpc instance_npcname("#mstep05");
	disablenpc instance_npcname("#mstep06");
	disablenpc instance_npcname("#mstep07");
	disablenpc instance_npcname("#mstep08");
	disablenpc instance_npcname("#mstep09");
	disablenpc instance_npcname("#mstep10");
	disablenpc instance_npcname("#mstep11");
	end;
}

//------------------------------------------------------------
// Warp NPCs
//------------------------------------------------------------
1@nyr,179,168,0	warp	#dmswp01	1,1,2@nyr,34,221

1@nyr,43,26,0	script	#dmwrp02	WARPNPC,1,1,{
	end;
OnTouch_:
	warp "rachel",117,197;
	if ('nyr_main_step == 22) {
		if (ep18_1_main == 51) {
			changequest 17520,17521;
			ep18_1_main = 52;
		}
	}
	end;
}

2@nyr,56,104,0	warp	#mstep01	1,1,2@nyr,49,104

2@nyr,49,55,0	script	#mstep02	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,53,55;
	if ('nyr_main_step == 8)
		navigateto("2@nyr",119,73);
	end;
}

2@nyr,119,73,0	warp	#mstep03	1,1,2@nyr,119,65

2@nyr,119,67,0	script	#mstep04	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,119,75;
	if ('nyr_main_step == 10)
		navigateto("2@nyr",183,104);
	end;
}

2@nyr,183,104,0	warp	#mstep05	1,1,2@nyr,190,104

2@nyr,186,104,0	script	#mstep06	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,180,104;
	if ('nyr_main_step == 12)
		navigateto("2@nyr",133,109);
	end;
}

2@nyr,120,123,0	warp	#mstep07	1,1,2@nyr,120,126

2@nyr,120,137,0	script	#mstep08	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,120,147;
	if ('nyr_main_step == 13)
		navigateto("2@nyr",118,199);
	end;
}

2@nyr,120,141,0	script	#mstep09	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,120,134;
	if ('nyr_main_step == 16)
		navigateto("2@nyr",151,131);
	end;
}

2@nyr,151,131,0	script	#mstep10	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,159,131;
	if ('nyr_main_step == 16)
		navigateto("2@nyr",203,220);
	end;
}

2@nyr,203,220,0	warp	#mstep11	1,1,1@nyr,65,169


//------------------------------------------------------------
// Step 1
//------------------------------------------------------------
1@nyr,192,31,3	script	Miriam#dms101	EP18_NPC_MIRIAM,5,5,{
	end;
OnTouch:
	if ('nyr_main_step == 1) {
		navigateto("1@nyr",125,41);
		end;
	}
	if ('nyr_main_step != 0)
		end;

	'nyr_main_step = 1;
	setpcblock PCBLOCK_NPC, true;
	npctalk "冒險家！";
	emotion ET_SURPRISE;
	sleep2 1000;
	navigateto("1@nyr",125,41);
	setpcblock PCBLOCK_NPC, false;
	npctalk "眼前就是集合地點。";
	unitwalk getnpcid(0), 162,31, instance_npcname("Miriam#dms101") + "::OnMove1";
	sleep 2000;
	npctalk "跟我來。";
	end;

OnMove1:
	unitwalk getnpcid(0), 137,31, instance_npcname("Miriam#dms101") + "::OnMove2";
	end;
OnMove2:
	unitwalk getnpcid(0), 128,41, instance_npcname("Miriam#dms101") + "::OnMove3";
	npctalk "它就在我面前。";
	end;
OnMove3:
	if ('nyr_main_step != 1)
		end;
	'nyr_main_step = 2;

	npctalk "蘇阿德，現在情況怎麼樣？";
	npctalk "不允許再進入！", instance_npcname("Temple Guard#dms101");
	sleep 1000;
	npctalk "Miriam, adventurer. A little further this way.", instance_npcname("Suad#dms101");
	sleep 1000;
	npctalk "驚人的！他們對待我們就像對待罪犯一樣！", instance_npcname("Kun#dms112");
	npctalk "我們是否處在一個無法進入的地方？", instance_npcname("Angry Crowd#dms131");
	sleep 1500;
	npctalk "Hey, that was our great-grandmother's land!", instance_npcname("Angry Crowd#dms121");
	npctalk "我們也有權利來這裡！", instance_npcname("Angry Crowd#dms161");
	npctalk "黨的領導來了嗎？";
	sleep 2000;
	npctalk "是的！ ！離開這裡！", instance_npcname("Angry Crowd#dms191");
	npctalk "你把我們推開了！", instance_npcname("Angry Crowd#dms181");
	sleep 2000;
	npctalk "我們看起來不像人類嗎？", instance_npcname("Angry Crowd#dms101");
	npctalk "我們就這麼幸福嗎？", instance_npcname("Angry Crowd#dms131");
	sleep 2000;
	npctalk "我們正在主張我們的權利！", instance_npcname("Angry Crowd#dms121");
	npctalk "What is it, give it back!! Our land!!", instance_npcname("Angry Crowd#dms181");
	sleep 2000;
	npctalk "我們是這片土地的老主人，也是因定居者而流離失所的人民。", instance_npcname("Angry Crowd#dms101");
	npctalk "誰打擾我們了！", instance_npcname("Angry Crowd#dms141");
	sleep 2000;
	npctalk "我們來維護我們作為這片土地的長期主人的合法權利。", instance_npcname("Angry Crowd#dms101");
	npctalk "離開那些非法侵占我們土地的人！", instance_npcname("Angry Crowd#dms191");
	sleep 2000;
	npctalk "非法抗議是不允許的！解散！", instance_npcname("Temple Guard#dms101");
	npctalk "誰說違法的？", instance_npcname("Angry Crowd#dms151");
	npctalk "你告訴我們現在這是非法的嗎？", instance_npcname("Angry Crowd#dms171");
	sleep 2000;
	npctalk "我們的要求如下！", instance_npcname("Angry Crowd#dms101");
	sleep 2000;
	npctalk "一！我們是這片土地的主人！剷除非法侵占者！", instance_npcname("Angry Crowd#dms101");
	npctalk "離開！", instance_npcname("Angry Crowd#dms111");
	npctalk "離開！", instance_npcname("Angry Crowd#dms121");
	npctalk "離開！", instance_npcname("Angry Crowd#dms131");
	npctalk "離開！", instance_npcname("Angry Crowd#dms141");
	npctalk "離開！", instance_npcname("Angry Crowd#dms151");
	sleep 300;
	npctalk "逃離！", instance_npcname("Angry Crowd#dms161");
	npctalk "離開！", instance_npcname("Angry Crowd#dms171");
	npctalk "離開！", instance_npcname("Angry Crowd#dms181");
	npctalk "離開！", instance_npcname("Angry Crowd#dms191");
	sleep 2000;
	npctalk "一！廢除毫無根據的歧視政策，承認我們的權利！", instance_npcname("Angry Crowd#dms101");
	npctalk "接受吧！", instance_npcname("Angry Crowd#dms111");
	npctalk "接受吧！", instance_npcname("Angry Crowd#dms121");
	npctalk "接受吧！", instance_npcname("Angry Crowd#dms131");
	npctalk "接受吧！", instance_npcname("Angry Crowd#dms141");
	sleep 500;
	npctalk "接受吧！", instance_npcname("Angry Crowd#dms151");
	npctalk "接受吧！", instance_npcname("Angry Crowd#dms161");
	npctalk "接受吧！", instance_npcname("Angry Crowd#dms171");
	npctalk "接受吧！", instance_npcname("Angry Crowd#dms181");
	npctalk "接受吧！", instance_npcname("Angry Crowd#dms191");
	end;

OnStartMove2:
	npcspeed 100;
	unitwalk getnpcid(0), 137,31, instance_npcname("Miriam#dms101") + "::OnMove4";
	end;
OnMove4:
	disablenpc instance_npcname("Miriam#dms101");
	end;

OnGuy1:
	disablenpc instance_npcname("Ramachus#dms102");
	end;
OnGuy2:
	disablenpc instance_npcname("Kun#dms112");
	end;
OnGuy3:
	disablenpc instance_npcname("Yoppi#dms122");
	end;
}

1@nyr,125,41,3	script	Suad#dms101	4_EP18_SUAD,{
	if (is_party_leader() == false) {
		cutin "ep18_Suad_01.png",0;
		mes "[法庭]";
		mes "黨的負責人在哪裡？";
		close3;
	}
	if ('nyr_main_step == 2) {
		cutin "ep18_Suad_01.png",0;
		mes "[法庭]";
		mes "現在情況不是很好，武裝警衛似乎增加了他們的後衛...";
		next;
		select("你肯定在頂級突襲中遇到了很大的問題。");
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "或信息洩漏。否則，我們不會這樣準備。";
		next;
		cutin "",255;
		mes "[寺廟後衛]";
		mes "不再進入。";
		next;
		mes "[當地人]";
		mes "我們做了什麼！我們不應該來這裡嗎？";
		next;
		mes "[當地人]";
		mes "這個地方曾經是我們的土地！你為什麼要阻止我說原始所有者想進入我們的土地？";
		next;
		mes "[當地人]";
		mes "現在是非法佔領的人！";
		next;
		mes "[當地人]";
		mes "是什麼，還給它！我們的土地！";
		next;
		mes "[居民代表]";
		mes "我們是這片土地的長期所有者，也是被移民流離失所的流離失所者。";
		next;
		mes "[居民代表]";
		mes "作為這片土地的長期碩士，我們來主張應有的權利。";
		next;
		mes "[居民代表]";
		mes "我們的要求如下。";
		next;
		mes "[居民代表]";
		mes "一！我們是...";
		next;
		npctalk "現在是了。靜靜地跟著我。", instance_npcname("Ramachus#dms102");
		unitwalk getnpcid(0,instance_npcname("Ramachus#dms102")), 145,34, instance_npcname("Miriam#dms101") + "::OnGuy1";
		sleep2 1000;
		unitwalk getnpcid(0,instance_npcname("Kun#dms112")), 145,32, instance_npcname("Miriam#dms101") + "::OnGuy2";
		unitwalk getnpcid(0,instance_npcname("Yoppi#dms122")), 145,31, instance_npcname("Miriam#dms101") + "::OnGuy3";
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "蘇德。您對這些傢伙提供了任何特殊指示嗎？";
		cutin "ep18_Suad_01.png",0;
		mes "[法庭]";
		mes "不？為什麼？";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "嘿，你看到那些人嗎？他們謹慎地移動。他們是突襲聖殿的團體。";
		next;
		cutin "ep18_Suad_03.png",0;
		mes "[法庭]";
		mes "我沒有給出任何具體說明。您要獨自行動嗎？";
		next;
		select("看來你正朝聖殿走去。");
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "這是以前從未談論過的獨奏。我已經有了記錄，那不是一件好事嗎？我必須安靜地跟進。我不知道會再次發生。";
		next;
		cutin "ep18_Suad_01.png",0;
		mes "[法庭]";
		mes "你一個人去嗎？";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "要跟隨您，您需要一群人搬家嗎？一個人就足夠了。你在這裡。如果發生任何事情，我會發出信號。";
		next;
		if ('nyr_main_step == 2) {
			'nyr_main_step = 3;
			enablenpc instance_npcname("#dmswp01");
			enablenpc instance_npcname("Miriam#dms201");
		}
		donpcevent instance_npcname("Miriam#dms101") + "::OnStartMove2";
		cutin "ep18_Suad_03.png",0;
		mes "[法庭]";
		mes "可以嗎？他們只跟隨，但我不知道他們的目的。他們解除了武裝，但我不知道他們在隱藏什麼...";
		next;
		unittalk getcharid(3), "" + strcharinfo(0) + " : I'll follow.";
		mes "[法庭]";
		mes "那是安全的。我不能四處走動。米里亞姆（Miriam）留下了痕跡，所以她跟隨它。所以請。";
		close2;
		navigateto("1@nyr",179,164);
		cutin "",255;
		end;
	}
	if ('nyr_main_step == 3) {
		cutin "ep18_Suad_01.png",0;
		mes "[法庭]";
		mes "當心。";
		close2;
		navigateto("1@nyr",179,164);
		cutin "",255;
		end;
	}
	end;
}

1@nyr,130,34,1	script	Ramachus#dms102	EP18_ARMED_VILLAGER01,{
	end;
OnInstanceInit:
	npcspeed 100;
	end;
}
1@nyr,132,32,1	duplicate(Ramachus#dms102)	Kun#dms112	EP18_ARMED_VILLAGER02
1@nyr,130,31,1	duplicate(Ramachus#dms102)	Yoppi#dms122	EP18_ARMED_VILLAGER03

1@nyr,117,38,7	duplicate(dummy_npc)	Angry Crowd#dms171	4_EP18_GW_MIDDLE02
1@nyr,139,46,3	duplicate(dummy_npc)	Temple Guard#dms101	4_M_RASWORD
1@nyr,132,46,3	duplicate(dummy_npc)	Temple Guard#dms111	4_M_RASWORD
1@nyr,126,46,3	duplicate(dummy_npc)	Temple Guard#dms121	4_M_RASWORD
1@nyr,122,46,3	duplicate(dummy_npc)	Temple Guard#dms131	4_M_RASWORD
1@nyr,118,46,5	duplicate(dummy_npc)	Temple Guard#dms141	4_M_RASWORD
1@nyr,110,46,5	duplicate(dummy_npc)	Temple Guard#dms151	4_M_RASWORD

1@nyr,120,44,5	duplicate(dummy_npc)	Temple Guard#dms181	4_M_RASWORD
1@nyr,124,44,3	duplicate(dummy_npc)	Temple Guard#dms191	4_M_RASWORD
1@nyr,137,38,1	duplicate(dummy_npc)	Angry Crowd#dms101	4_EP18_GW_MAN01
1@nyr,124,36,1	duplicate(dummy_npc)	Angry Crowd#dms111	4_EP18_GW_WOMAN01
1@nyr,131,38,1	duplicate(dummy_npc)	Angry Crowd#dms121	4_EP18_GW_MAN02
1@nyr,127,34,1	duplicate(dummy_npc)	Angry Crowd#dms131	4_M_MIDDLE
1@nyr,121,40,7	duplicate(dummy_npc)	Angry Crowd#dms141	4_EP18_GW_WOMAN02
1@nyr,122,37,7	duplicate(dummy_npc)	Angry Crowd#dms151	4_EP18_GW_MIDDLE01
1@nyr,118,35,7	duplicate(dummy_npc)	Angry Crowd#dms161	4_M_RACHMAN1
1@nyr,114,36,7	duplicate(dummy_npc)	Angry Crowd#dms181	4_F_SHABBY
1@nyr,116,41,7	duplicate(dummy_npc)	Angry Crowd#dms191	4_EP18_GW_WOMAN01


//------------------------------------------------------------
// Step 2
//------------------------------------------------------------
// (disabled since we are using Miriam instead)
// 2@nyr,37,219,0	script	#ar101sw	HIDDEN_WARP_NPC,5,5

2@nyr,37,219,3	script	Miriam#dms201	4_EP18_MIRIAM,5,5,{
	if (is_party_leader() == false) {
		npctalk "黨的領袖是誰？";
		end;
	}
	if ('nyr_main_step != 4)
		end;
	mes "[寺廟後衛]";
	mes "這是一個禁區。";
	next;
	cutin "ep18_miriam_01.png",2;
	mes "[米麗亞姆]";
	mes "我是米里亞姆（Miriam），大祭司青年阿馬爾（Amal）的女兒。我在這裡看到並追捕可疑的人。";
	next;
	cutin "",255;
	mes "[寺廟後衛]";
	mes "您在這裡幫助大祭司嗎？";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "工作，幫助...？你父親在這裡嗎？";
	next;
	cutin "",255;
	mes "[寺廟後衛]";
	mes "啊...";
	next;
	mapannounce 'map_2nyr$, "Look.", bc_map, 0xFFCC;
	mes "[寺廟後衛]";
	mes "這裡沒有人可疑。回去。";
	next;
	mapannounce 'map_2nyr$, "Be careful.", bc_map, 0xFFCC;
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "不是真的有可疑的人嗎？他們肯定進入了這個地方。給我一點，我會迅速檢查一下。";
	next;
	cutin "",255;
	mes "[寺廟後衛]";
	mes "如果您比這更接近，我會回應。";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "...我無能為力。冒險家？";
	next;
	select("是的，我會處理的，所以請繼續關注。");
	mes "[米麗亞姆]";
	mes "那請！我會留下痕跡，所以來找我。";
	next;
	cutin "",255;
	mes "[寺廟後衛]";
	mes "入侵者...！哎呀！ ！ ！";
	if ('nyr_main_step == 4) {
		'nyr_main_step = 5;
		donpcevent instance_npcname("nyr_step_2") + "::OnStart";
	}
	close;

OnTouch:
	// note: player can move
	if ('nyr_main_step != 3)
		end;
	'nyr_main_step = 4;
	npctalk "你是冒險家嗎？";
	npctalk "冒險家？你為什麼在這裡？";
	sleep 2000;
	npctalk "一定是蘇阿德發來的。無需擔心。";
	sleep 1000;
	enablenpc instance_npcname("Temple Guard#dms201");
	enablenpc instance_npcname("Temple Guard#dms211");
	enablenpc instance_npcname("Temple Guard#dms221");
	enablenpc instance_npcname("Temple Guard#dms231");
	enablenpc instance_npcname("Temple Guard#dms241");
	sleep 500;
	npctalk "你是誰！暴露你的身份。", instance_npcname("Temple Guard#dms201");
	npctalk "……大概就這樣悄無聲息地過去了，似乎很難走不是嗎？";
	end;
}

2@nyr,35,215,7	duplicate(dummy_npc)	Temple Guard#dms201	4_M_RASWORD
2@nyr,34,212,7	duplicate(dummy_npc)	Temple Guard#dms211	4_M_RASWORD
2@nyr,36,212,1	duplicate(dummy_npc)	Temple Guard#dms221	4_M_RASWORD
2@nyr,33,209,7	duplicate(dummy_npc)	Temple Guard#dms231	4_M_RASWORD
2@nyr,38,209,1	duplicate(dummy_npc)	Temple Guard#dms241	4_M_RASWORD


2@nyr,1,1,0	script	nyr_step_2	-1,{
	end;
OnStart:
	// disabled npcs from step 1
	disablenpc instance_npcname("Miriam#dms101");
	disablenpc instance_npcname("Suad#dms101");
	disablenpc instance_npcname("Ramachus#dms102");
	disablenpc instance_npcname("Kun#dms112");
	disablenpc instance_npcname("Yoppi#dms122");
	disablenpc instance_npcname("Angry Crowd#dms171");
	disablenpc instance_npcname("Temple Guard#dms101");
	disablenpc instance_npcname("Temple Guard#dms111");
	disablenpc instance_npcname("Temple Guard#dms121");
	disablenpc instance_npcname("Temple Guard#dms131");
	disablenpc instance_npcname("Temple Guard#dms141");
	disablenpc instance_npcname("Temple Guard#dms151");
	disablenpc instance_npcname("Temple Guard#dms181");
	disablenpc instance_npcname("Temple Guard#dms191");
	disablenpc instance_npcname("Angry Crowd#dms101");
	disablenpc instance_npcname("Angry Crowd#dms111");
	disablenpc instance_npcname("Angry Crowd#dms121");
	disablenpc instance_npcname("Angry Crowd#dms131");
	disablenpc instance_npcname("Angry Crowd#dms141");
	disablenpc instance_npcname("Angry Crowd#dms151");
	disablenpc instance_npcname("Angry Crowd#dms161");
	disablenpc instance_npcname("Angry Crowd#dms181");
	disablenpc instance_npcname("Angry Crowd#dms191");
	disablenpc instance_npcname("#dmswp01");

	disablenpc instance_npcname("Miriam#dms201");
	disablenpc instance_npcname("Temple Guard#dms201");
	disablenpc instance_npcname("Temple Guard#dms211");
	disablenpc instance_npcname("Temple Guard#dms221");
	disablenpc instance_npcname("Temple Guard#dms231");
	disablenpc instance_npcname("Temple Guard#dms241");
	sleep 500;
	.@label$ = instance_npcname("nyr_step_2") + "::OnMobDead";
	monster 'map_2nyr$,35,215,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,34,212,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,36,212,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,33,209,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,38,209,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	end;
OnMobDead:
	if ('nyr_main_step != 5)
		end;
	if (mobcount('map_2nyr$, instance_npcname("nyr_step_2") + "::OnMobDead") < 1) {
		'nyr_main_step = 6;
		mapannounce 'map_2nyr$, "Did you hear a fight somewhere?", bc_map, 0xFFCC;
		enablenpc instance_npcname("#mstep01");
		enablenpc instance_npcname("Miriam#dms301");
		enablenpc instance_npcname("Ramachus#dms201");
		enablenpc instance_npcname("Yoppi#dms221");
		enablenpc instance_npcname("Kun#dms211");
		enablenpc instance_npcname("#msna01");
	}
	end;
}

2@nyr,37,145,0	script	#msna01	HIDDEN_WARP_NPC,5,5,{
	end;
OnTouch:
	if ('nyr_main_step == 6)
		navigateto("2@nyr",56,104);
	end;
}


//------------------------------------------------------------
// Step 3
//------------------------------------------------------------
2@nyr,43,94,3	script	Miriam#dms301	4_EP18_MIRIAM,5,5,{
	end;
OnTouch:
	if ('nyr_main_step != 6)
		end;
	npctalk "不客氣。噓——看到那邊那些人了嗎？";
	npctalk "我很困，因為我聞到了書的味道。", instance_npcname("Ramachus#dms201");
	end;
}

2@nyr,37,93,5	script	Ramachus#dms201	EP18_ARMED_VILLAGER01,{
	if ('nyr_main_step != 6)
		end;
	if (is_party_leader() == false)
		end;
	mes "[米麗亞姆]";
	mes "你在這裡做什麼？";
	next;
	cutin "",255;
	mes "[拉馬科斯]";
	mes "灰！驚喜！你在這裡做什麼？甚至冒險家？";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "您現在不應該在這裡。如果寺廟一側發現，這只會使我們的位置更加困難。";
	next;
	cutin "",255;
	mes "[拉馬科斯]";
	mes "你看不到嗎？您正在開設圖書館。這裡必須有很多移民的秘密。";
	npctalk "思考。如果我們得到這一切怎麼辦？", instance_npcname("Kun#dms211");
	npctalk "我們可以克服我們的弱點！", instance_npcname("Yoppi#dms221");
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "這是以後要考慮的事情。現在，回去。回來。現在，您的行動使我們更加危險。";
	next;
	cutin "",255;
	mes "[約皮]";
	mes "你回去，米里亞姆。我不會和那些沮喪的人一起行動。";
	npctalk "我們的未來是什麼？", instance_npcname("Kun#dms211");
	next;
	enablenpc instance_npcname("Temple Guard#dms301");
	mes "[寺廟後衛]";
	mes "在這裡，入侵者！";
	next;
	enablenpc instance_npcname("Temple Guard#dms311");
	enablenpc instance_npcname("Temple Guard#dms321");
	enablenpc instance_npcname("Temple Guard#dms331");
	enablenpc instance_npcname("Temple Guard#dms341");
	mes "[寺廟後衛]";
	mes "每個人都放下武器並舉手！";
	next;
	select("我該怎麼做？");
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "首先，沒有多少，所以讓我們與他們打交道。";
	next;
	cutin "",255;
	mes "[什麼時候]";
	mes "你很開心。我們走吧！";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "等待！ ！冒險家！";
	next;
	select("把它留在這裡！");
	if ('nyr_main_step == 6) {
		'nyr_main_step = 7;
		donpcevent instance_npcname("nyr_step_3") + "::OnStart";
	}
	cutin "",255;
	end;
}

2@nyr,35,90,5	duplicate(dummy_npc)	Yoppi#dms221	EP18_ARMED_VILLAGER03
2@nyr,32,93,1	duplicate(dummy_npc)	Kun#dms211	EP18_ARMED_VILLAGER02

2@nyr,1,1,0	script	nyr_step_3	-1,{
	end;
OnStart:
	disablenpc instance_npcname("Miriam#dms301");
	disablenpc instance_npcname("Ramachus#dms201");
	disablenpc instance_npcname("Yoppi#dms221");
	disablenpc instance_npcname("Kun#dms211");
	disablenpc instance_npcname("Temple Guard#dms301");
	disablenpc instance_npcname("Temple Guard#dms311");
	disablenpc instance_npcname("Temple Guard#dms321");
	disablenpc instance_npcname("Temple Guard#dms331");
	disablenpc instance_npcname("Temple Guard#dms341");
	.@label$ = instance_npcname("nyr_step_3") + "::OnMobDead";
	monster 'map_2nyr$,45,96,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,47,94,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,43,96,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,47,98,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,44,98,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	end;
OnMobDead:
	if ('nyr_main_step != 7)
		end;
	if (mobcount('map_2nyr$, instance_npcname("nyr_step_3") + "::OnMobDead") < 1) {
		'nyr_main_step = 8;
		mapannounce 'map_2nyr$, "Somehow, my back is chilling... It seems like someone is watching...?", bc_map, 0xFFCC;
		disablenpc instance_npcname("#mstep01");
		enablenpc instance_npcname("#mstep02");
		enablenpc instance_npcname("#mstep03");
		enablenpc instance_npcname("Miriam#dms401");
		enablenpc instance_npcname("Ramachus#dms301");
		enablenpc instance_npcname("Kun#dms311");
		enablenpc instance_npcname("Yoppi#dms321");
	}
	end;
}

2@nyr,45,96,3	duplicate(dummy_npc)	Temple Guard#dms301	4_M_RASWORD
2@nyr,47,94,3	duplicate(dummy_npc)	Temple Guard#dms311	4_M_RASWORD
2@nyr,43,96,3	duplicate(dummy_npc)	Temple Guard#dms321	4_M_RASWORD
2@nyr,47,98,3	duplicate(dummy_npc)	Temple Guard#dms331	4_M_RASWORD
2@nyr,44,98,3	duplicate(dummy_npc)	Temple Guard#dms341	4_M_RASWORD


//------------------------------------------------------------
// Step 4
//------------------------------------------------------------
2@nyr,87,47,5	script	Miriam#dms401	4_EP18_MIRIAM,5,5,{
	end;
OnTouch:
	npctalk "聲音是從這邊傳來的。";
	npctalk "沉...張...", instance_npcname("Ramachus#dms301");
	end;
}

2@nyr,99,47,1	script	Ramachus#dms301	EP18_ARMED_VILLAGER01,{
	if ('nyr_main_step != 8)
		end;
	if (is_party_leader() == false)
		end;
	mes "[拉馬科斯]";
	mes "你找到了嗎？您只在這裡談論教派嗎？";
	next;
	mes "[什麼時候]";
	mes "還沒有。我不認為他在這裡。哦，等等...教皇...？";
	next;
	mes "[約皮]";
	mes "獨自留下無關的書。那不是我們想要的。";
	next;
	cutin "ep18_miriam_03.png",0;
	mes "[米麗亞姆]";
	mes "你...！";
	next;
	select("噓——等一下。");
	cutin "",255;
	mes "[拉馬科斯]";
	mes "即使這是一個秘密圖書館，也不會將這本書留在這樣的地方。";
	next;
	mes "[什麼時候]";
	mes "那麼秘密圖書館裡還有另一個秘密圖書館嗎？";
	next;
	mes "[約皮]";
	mes "我不知道。讓我們找到它。";
	next;
	mes "[什麼時候]";
	mes "很高興知道標題。";
	next;
	mes "[拉馬科斯]";
	mes "如果您知道這一點，那就是這樣。他們告訴我帶來所有看起來相似的東西。快速找到它們。";
	next;
	select("找一些具體的東西 看起來不是這樣嗎？");
	mes "[米麗亞姆]";
	mes "一本特定的書...？不是一本弱點的書嗎？";
	next;
	cutin "ep18_miriam_03.png",0;
	mes "[米麗亞姆]";
	mes "不，這些？嘿！你要買什麼？目的是什麼？";
	next;
	cutin "",255;
	mes "[約皮]";
	mes "哦，你又來了！你為什麼暗中聽我說？好像你有骯髒的心。";
	npctalk "你為什麼一直追我？你為什麼老是打斷我？", instance_npcname("Kun#dms311");
	next;
	cutin "ep18_miriam_03.png",0;
	mes "[米麗亞姆]";
	mes "你忘記了嗎？你真的用骯髒的頭腦偷偷摸摸嗎？您在尋找什麼書？";
	next;
	cutin "",255;
	mes "[拉馬科斯]";
	mes "真的很痛，你。我們只是說我們可以過得好嗎？你們不知道我們都想一起生活嗎？";
	npctalk "你現在在密謀我們嗎？", instance_npcname("Yoppi#dms321");
	npctalk "你對我們說什麼了？", instance_npcname("Kun#dms311");
	next;
	mes "[拉馬科斯]";
	mes "不知道我們的誠意的人。無論如何，時間到了...";
	next;
	cutin "ep18_miriam_03.png",0;
	mes "[米麗亞姆]";
	mes "您必須抓住他們，讓他們張開嘴...！";
	next;
	cutin "",255;
	mes "[寺廟後衛]";
	mes "這裡！入侵者在這裡！ ！ ！";
	enablenpc instance_npcname("Temple Guard#dms401");
	enablenpc instance_npcname("Temple Guard#dms411");
	enablenpc instance_npcname("Temple Guard#dms421");
	enablenpc instance_npcname("Temple Guard#dms431");
	enablenpc instance_npcname("Temple Guard#dms441");
	npctalk "來！ ！ ！幹得好！伙計們，我們走吧！", instance_npcname("Ramachus#dms301");
	npctalk "I'll track you down, adventurer, take care of these guys!", instance_npcname("Miriam#dms401");
	next;
	mes "[寺廟後衛]";
	mes "放下武器！";
	if ('nyr_main_step == 8) {
		'nyr_main_step = 9;
		donpcevent instance_npcname("nyr_step_4") + "::OnStart";
	}
	close;
}

2@nyr,93,36,3	duplicate(dummy_npc)	Kun#dms311	EP18_ARMED_VILLAGER02
2@nyr,99,38,5	duplicate(dummy_npc)	Yoppi#dms321	EP18_ARMED_VILLAGER03
2@nyr,88,44,5	duplicate(dummy_npc)	Temple Guard#dms401	4_M_RASWORD
2@nyr,87,46,5	duplicate(dummy_npc)	Temple Guard#dms411	4_M_RASWORD
2@nyr,87,42,5	duplicate(dummy_npc)	Temple Guard#dms421	4_M_RASWORD
2@nyr,85,46,5	duplicate(dummy_npc)	Temple Guard#dms431	4_M_RASWORD
2@nyr,85,42,5	duplicate(dummy_npc)	Temple Guard#dms441	4_M_RASWORD


2@nyr,1,1,0	script	nyr_step_4	-1,{
	end;
OnStart:
	disablenpc instance_npcname("Miriam#dms401");
	disablenpc instance_npcname("Ramachus#dms301");
	disablenpc instance_npcname("Kun#dms311");
	disablenpc instance_npcname("Yoppi#dms321");
	disablenpc instance_npcname("Temple Guard#dms401");
	disablenpc instance_npcname("Temple Guard#dms411");
	disablenpc instance_npcname("Temple Guard#dms421");
	disablenpc instance_npcname("Temple Guard#dms431");
	disablenpc instance_npcname("Temple Guard#dms441");
	.@label$ = instance_npcname("nyr_step_4") + "::OnMobDead";
	monster 'map_2nyr$,88,44,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,87,46,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,87,42,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,85,46,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,85,42,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	end;
OnMobDead:
	if ('nyr_main_step != 9)
		end;
	if (mobcount('map_2nyr$, instance_npcname("nyr_step_4") + "::OnMobDead") < 1) {
		'nyr_main_step = 10;
		mapannounce 'map_2nyr$, "Somehow ominous. I think he's still following us.", bc_map, 0xFFCC;
		disablenpc instance_npcname("#mstep02");
		disablenpc instance_npcname("#mstep03");
		enablenpc instance_npcname("#mstep04");
		enablenpc instance_npcname("#mstep05");
		enablenpc instance_npcname("Miriam#dms501");
		enablenpc instance_npcname("Ramachus#dms401");
		enablenpc instance_npcname("Kun#dms411");
		enablenpc instance_npcname("Yoppi#dms421");
	}
	end;
}


//------------------------------------------------------------
// Step 5
//------------------------------------------------------------
2@nyr,209,98,5	script	Miriam#dms501	4_EP18_MIRIAM,5,5,{
	if (is_party_leader() == false)
		npctalk "黨的領導不是決定來了嗎？", instance_npcname("Miriam#dms501");
	end;
OnTouch:
	npctalk "你能看到那邊的書架嗎？";
	npctalk "我的手指會這樣磨損。", instance_npcname("Ramachus#dms401");
	end;
}

2@nyr,212,104,1	script	Ramachus#dms401	EP18_ARMED_VILLAGER01,{
	if ('nyr_main_step != 10)
		end;
	if (is_party_leader() == false)
		end;
	mes "[約皮]";
	mes "這不是最後一次嗎？";
	next;
	mes "[拉馬科斯]";
	mes "這是正確的。必須有一個真正的秘密圖書館。";
	npctalk "Uh-huh, that's a bummer.", instance_npcname("Yoppi#dms421");
	npctalk "難道你不打算為自己的失敗負責嗎？", instance_npcname("Kun#dms411");
	next;
	mes "[拉馬科斯]";
	mes "我不是要讓您來找它，因為您首先要我尋找它。";
	next;
	mes "[什麼時候]";
	mes "詢問我是否可以退出。";
	next;
	npctalk "This is a wolf, a wolf.", instance_npcname("Ramachus#dms401");
	sleep2 2000;
	npctalk "？ ？ ？ ：你發現什麼了嗎？", instance_npcname("Ramachus#dms401");
	sleep2 2000;
	npctalk "This is the last library, but it doesn't seem to be here.", instance_npcname("Ramachus#dms401");
	sleep2 2000;
	npctalk "？ ？ ？ ： 等待。", instance_npcname("Ramachus#dms401");
	sleep2 1000;
	npctalk "你真的很頑強。你似乎非常擅長殺死所有守衛。", instance_npcname("Yoppi#dms421");
	mes "[什麼時候]";
	mes "等等，我現在很傻嗎？那裡有Miriam和一個冒險家。";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "您現在與誰聯繫？";
	next;
	select("你收到訂單了嗎？");
	cutin "",255;
	mes "[拉馬科斯]";
	mes "醬？我們不明白，對嗎？";
	npctalk "我相信買家。", instance_npcname("Kun#dms411");
	npctalk "我們從不背叛。", instance_npcname("Yoppi#dms421");
	next;
	enablenpc instance_npcname("Temple Guard#dms501");
	enablenpc instance_npcname("Temple Guard#dms511");
	enablenpc instance_npcname("Temple Guard#dms521");
	enablenpc instance_npcname("Temple Guard#dms531");
	enablenpc instance_npcname("Temple Guard#dms541");
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms501")),203,95;
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms511")),201,96;
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms521")),201,93;
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms531")),199,98;
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms541")),199,92;

	sleep2 500;
	npctalk "就是這樣！", instance_npcname("Temple Guard#dms501");
	npctalk "嘿！ ！你來了！ ！", instance_npcname("Ramachus#dms401");
	sleep2 1000;
	enablenpc instance_npcname("Shulang#dms101");
	unitwalk getnpcid(0,instance_npcname("Shulang#dms101")),206,96;
	npctalk "......", instance_npcname("Shulang#dms101");
	npctalk "你在這裡？", instance_npcname("Ramachus#dms401");
	npctalk "你在這裡！", instance_npcname("Kun#dms411");
	npctalk "你在這裡？", instance_npcname("Yoppi#dms421");
	sleep2 2000;

	cutin "ep18_Shulang.png",0;	// when almost finsh walking
	mes "[??]";
	mes "這是這裡的最後一個庫嗎？";
	next;
	cutin "",255;
	mes "[拉馬科斯]";
	mes "是的。";
	next;
	cutin "ep18_Shulang.png",0;
	mes "[??]";
	mes "我希望我能找到這本書，但我不能。我已經完成了那邊的工作，所以我要在這裡離開。";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "你是誰！您在這裡與這些傢伙有什麼關係？";
	next;
	cutin "ep18_Shulang.png",0;
	mes "[??]";
	mes "什麼？你穿了什麼？";
	next;
	cutin "",255;
	mes "[約皮]";
	mes "我擔心有人不是狼，所以我嗅了它並跟隨它。我會盡快處理。";
	next;
	cutin "ep18_Shulang.png",0;
	mes "[??]";
	mes "你不必。您只需退出並將其留給這些新移民。";
	next;
	cutin "",255;
	mes "[拉馬科斯]";
	mes "是的！ ！";
	next;
	next;
	disablenpc instance_npcname("Shulang#dms101");
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "等待！ ！ ！";
	next;
	cutin "",255;
	mes "[寺廟後衛]";
	mes "所有入侵者均已處理！";
	unittalk getcharid(3), "" + strcharinfo(0) + " : who is the intruder?";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "事情似乎奇怪地扭曲了嗎？甚至聖殿後衛也被賄賂。找出發生了什麼...";
	unittalk getcharid(3), "" + strcharinfo(0) + " : Leave these people to me.";
	next;
	cutin "",255;
	mes "[寺廟後衛]";
	mes "進入電力形成！";
	next;
	mes "[約皮]";
	mes "你好~見到你很髒，讓我們再見面嗎？";
	if ('nyr_main_step == 10) {
		'nyr_main_step = 11;
		donpcevent instance_npcname("nyr_step_5") + "::OnStart";
	}
	close;
}

2@nyr,220,98,5	duplicate(dummy_npc)	Kun#dms411	EP18_ARMED_VILLAGER02
2@nyr,220,95,5	duplicate(dummy_npc)	Yoppi#dms421	EP18_ARMED_VILLAGER03

2@nyr,197,96,5	duplicate(dummy_npc)	Shulang#dms101	EP18_MD_SCHULANG
2@nyr,197,95,5	duplicate(dummy_npc)	Temple Guard#dms501	EP18_MD_GUARD_A
2@nyr,197,96,5	duplicate(dummy_npc)	Temple Guard#dms511	EP18_MD_GUARD_A
2@nyr,197,93,5	duplicate(dummy_npc)	Temple Guard#dms521	EP18_MD_GUARD_A
2@nyr,197,98,5	duplicate(dummy_npc)	Temple Guard#dms531	EP18_MD_GUARD_A
2@nyr,197,92,5	duplicate(dummy_npc)	Temple Guard#dms541	EP18_MD_GUARD_A


2@nyr,1,1,0	script	nyr_step_5	-1,{
	end;
OnStart:
	disablenpc instance_npcname("Temple Guard#dms501");
	disablenpc instance_npcname("Temple Guard#dms511");
	disablenpc instance_npcname("Temple Guard#dms521");
	disablenpc instance_npcname("Temple Guard#dms531");
	disablenpc instance_npcname("Temple Guard#dms541");
	disablenpc instance_npcname("Ramachus#dms401");
	disablenpc instance_npcname("Kun#dms411");
	disablenpc instance_npcname("Yoppi#dms421");
	disablenpc instance_npcname("Miriam#dms501");
	.@label$ = instance_npcname("nyr_step_5") + "::OnMobDead";

	monster 'map_2nyr$,203,95,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,201,96,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,201,93,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,199,98,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,199,92,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	end;
OnMobDead:
	if ('nyr_main_step != 11)
		end;
	if (mobcount('map_2nyr$, instance_npcname("nyr_step_5") + "::OnMobDead") < 1) {
		'nyr_main_step = 12;
		mapannounce 'map_2nyr$, "Beep - Enable Storage Room Unlock Protocol", bc_map, 0xFFCC;
		disablenpc instance_npcname("#mstep04");
		disablenpc instance_npcname("#mstep05");

		enablenpc instance_npcname("#mstep06");
		enablenpc instance_npcname("Miriam#dms601");
		enablenpc instance_npcname("Ramachus#dms501");
		enablenpc instance_npcname("Kun#dms511");
		enablenpc instance_npcname("Yoppi#dms521");
		enablenpc instance_npcname("Shulang#dms201");
		enablenpc instance_npcname("Bagot#dms101");
		enablenpc instance_npcname("Private Officer#dms101");
		enablenpc instance_npcname("Temple Guard#dms601");
		enablenpc instance_npcname("Temple Guard#dms611");
		enablenpc instance_npcname("Temple Guard#dms621");
	}
	end;
}


//------------------------------------------------------------
// Step 6
//------------------------------------------------------------
// 2@nyr,132,108,0	duplicate(dummy_npc)	#dmss101	HIDDEN_WARP_NPC,3,3

2@nyr,133,109,3	script	Miriam#dms601	EP18_NPC_MIRIAM,5,5,{
	if (is_party_leader() == false) {
		npctalk "我認為聚會還沒有到來。";
		end;
	}
	if ('nyr_main_step != 12)
		end;
	.@miriam$ = instance_npcname("Miriam#dms601");
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "你在幹什麼？那裡有多少人？很難從這裡看到，您能看到什麼嗎？";
	next;
	select("有些人不知道。");
	cutin "ep18_Shulang.png",1;
	mes "[？ ？ ？ ]";
	mes "你還遙遠嗎？";
	next;
	cutin "",255;
	mes "[拉馬科斯]";
	mes "看起來您快要完成了。";
	next;
	cutin "ep18_bagot_01.png",1;
	mes "[？ ？ ？ ]";
	mes "確實，實際上，安全性是徹底的。";
	next;
	cutin "",255;
	mes "[？ ？ ？ ]";
	mes "...他們沒有這種安全性嗎？";
	next;
	cutin "ep18_bagot_02.png",1;
	mes "[？ ？ ？ ]";
	mes "先生，你不知道諷刺嗎？緊張的安全性不是繁瑣且苛刻的程序的代名詞，不是嗎？";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "這個聲音...";
	emotion ET_HUK, playerattached();
	donpcevent .@miriam$ + "::OnEffect";
	next;
	select("你認識什麼人嗎？");
	mes "[米麗亞姆]";
	mes "我不確定，因為它是隱藏的...";
	next;
	cutin "",255;
	mes "[？ ？ ？ ]";
	mes "進去。";
	if ('nyr_main_step != 12)
		close;
	next;
	'nyr_main_step = 13;
	disablenpc instance_npcname("#mstep06");
	enablenpc instance_npcname("#mstep07");
	enablenpc instance_npcname("#mstep08");

	enablenpc instance_npcname("Miriam#dms701");
	enablenpc instance_npcname("Ramachus#dms601");
	enablenpc instance_npcname("Kun#dms611");
	enablenpc instance_npcname("Yoppi#dms621");
	enablenpc instance_npcname("Shulang#dms301");
	enablenpc instance_npcname("Bagot#dms201");
	enablenpc instance_npcname("Temple Guard#dms721");
	enablenpc instance_npcname("Temple Guard#dms731");
	enablenpc instance_npcname("Temple Guard#dms741");

	unitwalk getnpcid(0,instance_npcname("Ramachus#dms501")), 120,120, .@miriam$ + "::OnMove1";
	sleep2 2000;
	unitwalk getnpcid(0,instance_npcname("Kun#dms511")), 120,121, .@miriam$ + "::OnMove2";
	unitwalk getnpcid(0,instance_npcname("Yoppi#dms521")), 122,121, .@miriam$ + "::OnMove3";
	sleep2 1000;
	unitwalk getnpcid(0,instance_npcname("Shulang#dms201")), 120,121, .@miriam$ + "::OnMove4";
	sleep2 500;
	disablenpc instance_npcname("Bagot#dms101");
	disablenpc instance_npcname("Private Officer#dms101");
	sleep2 1000;
	npctalk "這邊走！快點來追我吧！";
	cutin "ep18_miriam_03.png",2;
	mes "[米麗亞姆]";
	mes "讓我們也去。";
	sleep2 1000;
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms601")), 118,121, .@miriam$ + "::OnMove5";
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms611")), 118,121, .@miriam$ + "::OnMove6";
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms621")), 117,121, .@miriam$ + "::OnMove7";
	close2;
	unitwalk getnpcid(0,.@miriam$), 122,119, .@miriam$ + "::OnMove8";
	cutin "",255;
	end;

OnEffect:
	enablenpc instance_npcname("#effc01");
	specialeffect EF_MAPPILLAR2, AREA, instance_npcname("#effc01");
	sleep 1000;
	npctalk "靜-拍手-", instance_npcname("#effc01");
	end;

OnMove1:
	disablenpc instance_npcname("Ramachus#dms501");
	end;
OnMove2:
	disablenpc instance_npcname("Kun#dms511");
	end;
OnMove3:
	disablenpc instance_npcname("Yoppi#dms521");
	end;
OnMove4:
	disablenpc instance_npcname("Shulang#dms201");
	end;
OnMove5:
	disablenpc instance_npcname("Temple Guard#dms601");
	end;
OnMove6:
	disablenpc instance_npcname("Temple Guard#dms611");
	end;
OnMove7:
	disablenpc instance_npcname("Temple Guard#dms621");
	end;
OnMove8:
	disablenpc instance_npcname("Miriam#dms601");
	end;

OnTouch:
	if ('nyr_main_step == 12)
		npctalk "餵，還有其他人嗎？你在說什麼？";
	end;
}
2@nyr,125,111,3	duplicate(dummy_npc)	Ramachus#dms501	EP18_ARMED_VILLAGER01
2@nyr,128,107,3	duplicate(dummy_npc)	Kun#dms511	EP18_ARMED_VILLAGER02
2@nyr,128,104,3	duplicate(dummy_npc)	Yoppi#dms521	EP18_ARMED_VILLAGER03
2@nyr,125,101,1	duplicate(dummy_npc)	Shulang#dms201	EP18_MD_SCHULANG
2@nyr,122,106,3	duplicate(dummy_npc)	Bagot#dms101	4_EP18_Bagot
2@nyr,120,107,3	duplicate(dummy_npc)	Private Officer#dms101	4_M_RACHOLD
2@nyr,115,102,5	duplicate(dummy_npc)	Temple Guard#dms601	EP18_MD_GUARD_A
2@nyr,116,106,5	duplicate(dummy_npc)	Temple Guard#dms611	EP18_MD_GUARD_A
2@nyr,117,98,7	duplicate(dummy_npc)	Temple Guard#dms621	EP18_MD_GUARD_A
2@nyr,119,103,0	duplicate(dummy_npc)	#effc01	HIDDEN_WARP_NPC



//------------------------------------------------------------
// Step 7 + 8
//------------------------------------------------------------
// 2@nyr,118,199,0	duplicate(dummy_npc)	#dms701	HIDDEN_WARP_NPC,1,5

2@nyr,118,199,1	script	Miriam#dms701	4_EP18_MIRIAM,5,5,{
	if (is_party_leader() == false) {
		npctalk "黨的領袖是誰？";
		end;
	}
	if ('nyr_main_step == 13) {
		mes "[？ ？ ？ ]";
		mes "Shulang，您確保了嗎？這個袋子即將用完耐心。";
		next;
		mes "[拉馬科斯]";
		mes "但是我們還必須穿這個嗎？";
		npctalk "很無聊。", instance_npcname("Yoppi#dms621");
		next;
		cutin "ep18_Shulang.png",0;
		mes "[Shu浪]";
		mes "這有什麼關係？一路來這裡。做你想做的事。";
		next;
		// Requires number as the aegis monster name is not a constant for now
		setnpcdisplay( instance_npcname("Ramachus#dms601"), 21308 );	// EP18_MD_HEARTHUNTER_A
		setnpcdisplay( instance_npcname("Kun#dms611"), 21308 );	// EP18_MD_HEARTHUNTER_A
		setnpcdisplay( instance_npcname("Yoppi#dms621"), 21308 );	// EP18_MD_HEARTHUNTER_A
		npctalk "我以為我要死了，因為太麻煩了！", instance_npcname("Kun#dms611");
		cutin "",255;
		mes "[約皮]";
		mes "hyah-我現在將生活。";
		next;
		select("獵心者偽裝了自己。");
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "Heart Hunter ...您談論的那些瘋狂的科學家之一...然後從一開始...！";
		next;
		cutin "",255;
		mes "[" + strcharinfo(0) + "]";
		mes "仍然有很多心臟獵人轉變為伊米爾的心，不是嗎？";
		next;
		cutin "ep18_Shulang.png",0;
		mes "[Shu浪]";
		mes "我們是球形的嗎？啊，他們是追隨你的矮人。我聽到了消息。";
		npctalk "Oh, those people? You're surprised that they've been following us so persistently. You owed us unknowingly?", instance_npcname("Bagot#dms201");
		next;
		select("那一定是幻覺。");
		cutin "ep18_bagot_02.png",1;
		mes "[巴戈特]";
		mes "啊，我很驚訝。你甚至知道如何嗎？很難賣掉你的臉。";
		npctalk "這有什麼關係呢？無論如何都會消失的。", instance_npcname("Shulang#dms301");
		next;
		enablenpc instance_npcname("Private Officer#dms201");
		enablenpc instance_npcname("Temple Guard#dms701");
		enablenpc instance_npcname("Temple Guard#dms711");
		cutin "",255;
		mes "[？ ？ ？ ]";
		mes "已經準備好了。";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "...父親？ ？";
		next;
		cutin "",255;
		mes "[青年amal]";
		mes "Miriam，到目前為止，您做得很好。您已經完成了自己的職責，現在就回去。";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "你好嗎...？什麼？";
		next;
		cutin "ep18_bagot_03.png",1;
		mes "[巴戈特]";
		mes "哇，我受到父親的稱讚。我希望。讚美育兒非常重要。";
		mes "Bagoti甚至不記得我什麼時候得到。嗯...啊！我從來沒有明白，所以我不記得了！";
		npctalk "I've gotten compliments, so I can go home and wash my feet and go to sleep.", instance_npcname("Bagot#dms201");
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "怎麼回事？為什麼我父親...我做了什麼？";
		next;
		cutin "",255;
		mes "[青年amal]";
		mes "...一旦得到所需的東西，就可以處理並去。";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "父親！父親！ ！ ！";
		next;
		cutin "ep18_bagot_01.png",4;
		disablenpc instance_npcname("Private Officer#dms201");
		mes "[巴戈特]";
		mes "該死！一個讚美你但沒有感情的父親？";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "你對父親做什麼？";
		next;
		cutin "ep18_bagot_03.png",1;
		mes "[巴戈特]";
		mes "哦，你不知道嗎？您說您的願望是將所有本地人趕出Arunafeltz。我們對此有所幫助。當然，它不是免費的。";
		npctalk "You have to do everything you want to do and buy. Otherwise, you will get sick.", instance_npcname("Bagot#dms201");
		npctalk "呵呵——模仿你可以嗎？也給我們一些讚美吧。", instance_npcname("Ramachus#dms601");
		next;
		cutin "",255;
		mes "[心臟獵手]";
		mes "Miriam感謝您和您的朋友，我們能夠完成這張暴動圖片。非常感謝！";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "您認為這是有道理的嗎？";
		next;
		cutin "ep18_bagot_01.png",1;
		mes "[巴戈特]";
		mes "你在說什麼？您去了幾次去聖殿抗議？";
		next;
		cutin "ep18_bagot_03.png",1;
		mes "[巴戈特]";
		mes "外面的抗議活動很快會變成騷亂？那麼您的願望就會實現。那你會做另一個願望？我們會再次獲得報酬嗎？";
		next;
		cutin "ep18_Shulang.png",0;
		mes "[Shu浪]";
		mes "我們要談論多長時間。我們走吧。";
		mes "快來清理。";
		next;
		cutin "",255;
		mes "[拉馬科斯]";
		mes "四！";
		next;
		disablenpc instance_npcname("Shulang#dms301");
		disablenpc instance_npcname("Bagot#dms201");
		mes "[心臟獵手]";
		mes "我希望這裡有一個蘇德。我想嘗試一下。";
		next;
		mes "[心臟獵手]";
		mes "您好，讓我正式介紹您。我們是心臟獵人。我們將很快埋葬您。";
		npctalk "我不只是一個獵心者。我是一個非常強大的獵心者。", instance_npcname("Kun#dms611");
		select("小心，它們是改裝過的。");
		next;
		cutin "ep18_miriam_03.png",2;
		specialeffect EF_UNDEADBODY, AREA, instance_npcname("Ramachus#dms601");
		specialeffect EF_NPC_STOP, AREA, instance_npcname("Ramachus#dms601");
		mes "[米麗亞姆]";
		mes "你有點不祥嗎？";
		next;
		select("這裡似乎與尤彌爾的內心產生了共鳴。");
		mes "[米麗亞姆]";
		mes "簡而言之，計數？好的。快點跟。";
		if ('nyr_main_step == 13) {
			'nyr_main_step = 14;
			donpcevent instance_npcname("nyr_step_7") + "::OnStart";
			removespecialeffect EF_UNDEADBODY, AREA, instance_npcname("Ramachus#dms601");
			removespecialeffect EF_NPC_STOP, AREA, instance_npcname("Ramachus#dms601");
		}
		close3;
	}
	if ('nyr_main_step == 15) {
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "哈...哈...冒險家，你還好嗎？";
		next;
		select("他們都去哪兒了？");
		enablenpc instance_npcname("Niren#dms101");
		enablenpc instance_npcname("Temple Guard#dms751");
		enablenpc instance_npcname("Temple Guard#dms761");
		enablenpc instance_npcname("Temple Guard#dms771");
		npctalk "這一切是什麼？", instance_npcname("Niren#dms101");
		cutin "ra_gwoman.bmp",0;
		mes "[NI人]";
		mes "這是什麼，所有這些大驚小怪。";
		mes "冒險家...？你為什麼在這裡？";
		next;
		select("這裡...");
		mes "[NI人]";
		mes "您一直在跟同事的可疑行為，但實際上是間諜。";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "你也和我父親一起參加同一個聚會嗎？";
		next;
		cutin "ra_gwoman.bmp",0;
		mes "[NI人]";
		mes "牧師？ ？還有什麼意思？";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "我認為我父親可能參與其中。";
		next;
		cutin "ra_gwoman.bmp",0;
		mes "[NI人]";
		mes "那是什麼...甚至大祭司...？必須進行調查。";
		mes "即使是在外面聚集的人，也必須有黑幫種植的隱藏煽動者...";
		next;
		select("也在聖殿守衛中。");
		mes "[NI人]";
		mes "需要大修。首先，我們需要找出我們在這裡所做的事情。有沒有危險的物體，或者沒有丟失的物體...";
		next;
		mes "[NI人]";
		mes "...!! !!";
		mes "無需調查。伊米爾的心臟碎片缺失。它應該在那裡。";
		next;
		select("也...");
		mes "[NI人]";
		mes "我什至無法想像該怎麼辦...";
		mes "不是這樣，我們需要告知事實並跟進...！";
		next;
		mes "[NI人]";
		mes "啊...！我說聖殿後衛將有敵軍。首先，我必須選擇一個可靠的人。";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "我去。這可能是我父親帶走的。我只能猜測它去了哪裡。";
		next;
		cutin "ra_gwoman.bmp",0;
		mes "[NI人]";
		mes "讓我們首先出去談論這個問題，因為外面的情況不是很好。";
		close2;
		cutin "",255;
		if ('nyr_main_step == 15) {
			'nyr_main_step = 16;
			disablenpc instance_npcname("Niren#dms101");
			disablenpc instance_npcname("Temple Guard#dms751");
			disablenpc instance_npcname("Temple Guard#dms761");
			disablenpc instance_npcname("Temple Guard#dms771");
			disablenpc instance_npcname("Miriam#dms701");

			enablenpc instance_npcname("#mstep09");
			enablenpc instance_npcname("#mstep10");
			enablenpc instance_npcname("#mstep11");
			enablenpc instance_npcname("Miriam#dms801");
			enablenpc instance_npcname("#dmswch02");

			enablenpc instance_npcname("Miriam#dms801");

			enablenpc instance_npcname("Temple Guard#dms801");
			enablenpc instance_npcname("Temple Guard#dms811");
			enablenpc instance_npcname("Temple Guard#dms821");
			enablenpc instance_npcname("Temple Guard#dms831");
			enablenpc instance_npcname("Temple Guard#dms841");
			enablenpc instance_npcname("Temple Guard#dms851");
			enablenpc instance_npcname("Temple Guard#dms861");
			enablenpc instance_npcname("Temple Guard#dms871");
			enablenpc instance_npcname("Temple Guard#dms881");
			enablenpc instance_npcname("Temple Guard#dms891");
			enablenpc instance_npcname("Angry Crowd#dms211");
			enablenpc instance_npcname("Angry Crowd#dms221");
			enablenpc instance_npcname("Angry Crowd#dms231");
			enablenpc instance_npcname("Angry Crowd#dms241");
			enablenpc instance_npcname("Angry Crowd#dms251");
			enablenpc instance_npcname("Angry Crowd#dms261");
			enablenpc instance_npcname("Angry Crowd#dms271");
			enablenpc instance_npcname("Angry Crowd#dms281");
			enablenpc instance_npcname("Angry Crowd#dms291");

			enablenpc instance_npcname("Angry Crowd#dms202");
			enablenpc instance_npcname("Angry Crowd#dms212");
			enablenpc instance_npcname("Angry Crowd#dms222");
			enablenpc instance_npcname("Angry Crowd#dms232");
			enablenpc instance_npcname("Angry Crowd#dms242");

			enablenpc instance_npcname("Temple Guard#dms802");
			enablenpc instance_npcname("Temple Guard#dms812");
			enablenpc instance_npcname("Temple Guard#dms822");
			enablenpc instance_npcname("Temple Guard#dms832");
			enablenpc instance_npcname("Temple Guard#dms842");
		}
		navigateto("2@nyr",120,141);
		end;
	}
	end;

OnTouch:
	if ('nyr_main_step == 13)
		npctalk "大家都聚集在那裡。";
	end;
}

2@nyr,120,206,3	duplicate(dummy_npc)	Ramachus#dms601	EP18_ARMED_VILLAGER01
2@nyr,119,207,3	duplicate(dummy_npc)	Kun#dms611	EP18_ARMED_VILLAGER02
2@nyr,111,207,5	duplicate(dummy_npc)	Yoppi#dms621	EP18_ARMED_VILLAGER03
2@nyr,115,204,5	duplicate(dummy_npc)	Shulang#dms301	4_EP18_Shulang
2@nyr,117,205,3	duplicate(dummy_npc)	Bagot#dms201	4_EP18_Bagot

2@nyr,112,201,5	duplicate(dummy_npc)	Temple Guard#dms721	4_M_RASWORD
2@nyr,121,203,3	duplicate(dummy_npc)	Temple Guard#dms731	4_M_RASWORD
2@nyr,121,201,3	duplicate(dummy_npc)	Temple Guard#dms741	4_M_RASWORD

2@nyr,115,202,5	duplicate(dummy_npc)	Private Officer#dms201	4_M_RACHOLD

2@nyr,113,203,5	duplicate(dummy_npc)	Temple Guard#dms701	4_M_RASWORD
2@nyr,118,203,3	duplicate(dummy_npc)	Temple Guard#dms711	4_M_RASWORD
2@nyr,120,202,3	duplicate(dummy_npc)	Temple Guard#dms751	4_M_RASWORD
2@nyr,114,203,5	duplicate(dummy_npc)	Temple Guard#dms761	4_M_RASWORD
2@nyr,115,199,7	duplicate(dummy_npc)	Temple Guard#dms771	4_M_RASWORD
2@nyr,117,204,3	duplicate(dummy_npc)	Niren#dms101	4_F_MADAME



2@nyr,1,1,0	script	nyr_step_7	-1,{
	end;
OnStart:
	disablenpc instance_npcname("#mstep07");
	disablenpc instance_npcname("#mstep08");
	disablenpc instance_npcname("Miriam#dms701");
	disablenpc instance_npcname("Ramachus#dms601");
	disablenpc instance_npcname("Kun#dms611");
	disablenpc instance_npcname("Yoppi#dms621");
	disablenpc instance_npcname("Temple Guard#dms701");
	disablenpc instance_npcname("Temple Guard#dms711");
	disablenpc instance_npcname("Temple Guard#dms721");
	disablenpc instance_npcname("Temple Guard#dms731");
	disablenpc instance_npcname("Temple Guard#dms741");
	sleep 500;
	.@label$ = instance_npcname("nyr_step_7") + "::OnMobDead";
	monster 'map_2nyr$,120,206,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_2nyr$,119,207,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_2nyr$,111,207,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_2nyr$,113,203,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,118,203,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,112,201,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,121,203,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,121,201,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	end;
OnMobDead:
	if ('nyr_main_step != 14)
		end;
	if (mobcount('map_2nyr$, instance_npcname("nyr_step_7") + "::OnMobDead") < 1) {
		'nyr_main_step = 15;
		enablenpc instance_npcname("Miriam#dms701");
	}
	end;
}


//------------------------------------------------------------
// Step 9
//------------------------------------------------------------
1@nyr,65,169,0	script	#dmswch02	HIDDEN_WARP_NPC,3,3,{
	end;
OnTouch:
	if ('nyr_main_step == 17) {
		navigateto("1@nyr",129,165);
		end;
	}
	if ('nyr_main_step != 16)
		end;
	'nyr_main_step = 17;
	donpcevent instance_npcname("Miriam#dms801") + "::OnMove1";
	navigateto("1@nyr",129,165);
	mapannounce 'map_1nyr$, "We are alive too! Get to know us!", bc_map, 0xFFCC;
	npctalk "事情似乎不太對勁。讓我們仔細看看。", instance_npcname("Miriam#dms801");
	sleep 2000;
	npctalk "就是這個", instance_npcname("Miriam#dms801");
	mapannounce 'map_1nyr$, "We are alive! We are alive!", bc_map, 0xFFCC;
	sleep 3000;
	mapannounce 'map_1nyr$, "We exist! We exist!", bc_map, 0xFFCC;
	sleep 5000;
	mapannounce 'map_1nyr$, "Give back the rights to the owner of this land! Give it back!", bc_map, 0xFFCC;
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms201");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms211");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms221");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms231");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms241");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms251");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms261");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms271");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms281");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms291");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms202");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms212");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms222");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms232");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms242");
	sleep 5000;
	mapannounce 'map_1nyr$, "We are alive! We are alive!", bc_map, 0xFFCC;
	npctalk "活！", instance_npcname("Angry Crowd#dms201");
	npctalk "活！", instance_npcname("Angry Crowd#dms211");
	npctalk "活！", instance_npcname("Angry Crowd#dms221");
	npctalk "活！", instance_npcname("Angry Crowd#dms231");
	npctalk "活！", instance_npcname("Angry Crowd#dms241");
	npctalk "活！", instance_npcname("Angry Crowd#dms251");
	npctalk "活！", instance_npcname("Angry Crowd#dms261");
	npctalk "活！", instance_npcname("Angry Crowd#dms271");
	npctalk "活！", instance_npcname("Angry Crowd#dms281");
	npctalk "活！", instance_npcname("Angry Crowd#dms291");
	npctalk "活！", instance_npcname("Angry Crowd#dms202");
	npctalk "活！", instance_npcname("Angry Crowd#dms212");
	npctalk "活！", instance_npcname("Angry Crowd#dms222");
	npctalk "活！", instance_npcname("Angry Crowd#dms232");
	npctalk "活！", instance_npcname("Angry Crowd#dms242");
	sleep 5000;
	mapannounce 'map_1nyr$, "We exist! We exist!", bc_map, 0xFFCC;
	npctalk "存在！", instance_npcname("Angry Crowd#dms201");
	npctalk "存在！", instance_npcname("Angry Crowd#dms211");
	npctalk "存在！", instance_npcname("Angry Crowd#dms221");
	npctalk "存在！", instance_npcname("Angry Crowd#dms231");
	npctalk "存在！", instance_npcname("Angry Crowd#dms241");
	npctalk "存在！", instance_npcname("Angry Crowd#dms251");
	npctalk "存在！", instance_npcname("Angry Crowd#dms261");
	npctalk "存在！", instance_npcname("Angry Crowd#dms271");
	npctalk "存在！", instance_npcname("Angry Crowd#dms281");
	npctalk "存在！", instance_npcname("Angry Crowd#dms291");
	npctalk "存在！", instance_npcname("Angry Crowd#dms202");
	npctalk "存在！", instance_npcname("Angry Crowd#dms212");
	npctalk "存在！", instance_npcname("Angry Crowd#dms222");
	npctalk "存在！", instance_npcname("Angry Crowd#dms232");
	npctalk "存在！", instance_npcname("Angry Crowd#dms242");
	sleep 5000;
	mapannounce 'map_1nyr$, "Give back the rights to the owner of this land! Give it back!", bc_map, 0xFFCC;
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms201");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms211");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms221");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms231");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms241");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms251");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms261");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms271");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms281");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms291");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms202");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms212");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms222");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms232");
	npctalk "把它還給我！", instance_npcname("Angry Crowd#dms242");
	end;
}

1@nyr,68,163,5	script	Miriam#dms801	EP18_NPC_MIRIAM,{
	if (is_party_leader() == false) {
		npctalk "黨的領導還沒來嗎？";
		end;
	}
	if ('nyr_main_step == 18) {
		mes "[人群]";
		mes "認識我們！";
		next;
		mes "[人群]";
		mes "我們也還活著！我們在這裡！";
		next;
		mes "[人群]";
		mes "這是我們的土地！";
		next;
		mes "[人群]";
		mes "將土地還給土地所有者！";
		next;
		mes "[寺廟後衛]";
		mes "如果您現在解散，我不會要求您闖入聖殿！";
		next;
		mes "[寺廟後衛]";
		mes "我給你一個半小時！準時回去！";
		next;
		mes "[人群]";
		mes "您現在威脅我們嗎？";
		next;
		mes "[人群]";
		mes "你要和我們做什麼？";
		next;
		mes "[人群]";
		mes "您要抓住他們所有人並將其入獄嗎？";
		next;
		mes "[人群]";
		mes "只要這樣，我們就會攻擊firstlet的行動！ ！ ！";
		next;
		cutin "ep18_miriam_03.png",1;
		mes "[米麗亞姆]";
		mes "有些奇怪。人們試圖成為激進";
		next;
		mes "[米麗亞姆]";
		mes "事情似乎不對。我需要打電話給蘇德。但是大祭司在哪裡？";
		npctalk "叫某人蘇阿德！匆忙！", instance_npcname("Miriam#dms801");
		next;
		enablenpc instance_npcname("Niren#dms201");
		enablenpc instance_npcname("Zhed#dms101");
		cutin "ra_gwoman.bmp",2;
		mes "[NI人]";
		mes "你在這裡。我還帶了大祭司Zhed。";
		next;
		cutin "ra_gman2.bmp",2;
		mes "[zhed]";
		mes "這是怎麼回事？它與這裡的人群有什麼關係嗎？或者，在聖殿內...";
		next;
		if ('nyr_main_step == 18) {
			'nyr_main_step = 19;
			disablenpc instance_npcname("#mstep09");
			disablenpc instance_npcname("#mstep10");
			disablenpc instance_npcname("#mstep11");
			disablenpc instance_npcname("#dmswch02");
			enablenpc instance_npcname("Suad#dms102");
			npctalk "這是怎麼回事？你說你是這麼著急才找到的？", instance_npcname("Suad#dms102");
		}
		cutin "ep18_Suad_04.png",0;
		mes "[法庭]";
		mes "這是怎麼回事？你說你很著急嗎？";
		close3;
	}
	if ('nyr_main_step == 21) {
		'nyr_main_step = 22;
		disablenpc instance_npcname("Miriam#dms801");
		enablenpc instance_npcname("#dmwrp02");
		navigateto("1@nyr",45,28);
		cutin "ep18_miriam_03.png",2;
		mes "[米麗亞姆]";
		mes "如果大致解決，請快速移動。每個人都在安全的地方等待。";
		close3;
	}
	end;

OnMove1:
	unitwalk getnpcid(0),90,153, instance_npcname("Miriam#dms801") + "::OnMove2";
	end;
OnMove2:
	unitwalk getnpcid(0),107,165, instance_npcname("Miriam#dms801") + "::OnMove3";
	end;
OnMove3:
	unitwalk getnpcid(0),128,165, instance_npcname("Miriam#dms801") + "::OnMove4";
	end;
OnMove4:
	'nyr_main_step = 18;
	end;
}


//------------------------------------------------------------
// Step 10
//------------------------------------------------------------
1@nyr,127,163,5	script	Suad#dms102	4_EP18_SUAD,{
	if (is_party_leader() == false) {
		npctalk "希望領導能以代表的身份告訴我。";
		end;
	}
	if ('nyr_main_step != 19)
		end;
	cutin "ep18_Suad_04.png",0;
	mes "[法庭]";
	mes "這是怎麼回事？";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米麗亞姆]";
	mes "我們中間有間諜。";
	next;
	cutin "ep18_Suad_04.png",0;
	mes "[法庭]";
	mes "間諜？在哪裡？";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米麗亞姆]";
	mes "蘇德（Suad），首先在這裡解釋情況。我認為我們正處於暴動的邊緣，對嗎？您好，大祭司Zhed。";
	next;
	cutin "ep18_Suad_02.png",0;
	mes "[法庭]";
	mes "為什麼大祭司在這裡？";
	next;
	cutin "ra_gman2.bmp",2;
	mes "[zhed]";
	mes "Miriam？ Miriam參與其中嗎？";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米麗亞姆]";
	mes "還有另一個原因。在此之前，請聽這種情況。蘇德？";
	next;
	cutin "ep18_Suad_03.png",0;
	mes "[法庭]";
	mes "現在不是很好。它失去了控制。寺廟的一面也很強烈地出現，並建議解散。剩下的時間不多。我們準備退出。";
	next;
	cutin "ep18_Suad_01.png",0;
	mes "[法庭]";
	mes "你追趕的人？它怎麼走了？";
	next;
	select("我會解釋一下。");
	cutin "",255;
	mes "- 我告訴你寺廟內發生了什麼。 -";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米麗亞姆]";
	mes "我的父親和外部力量串通了這樣做。分割阿魯納菲爾茨並壓迫當地人。";
	next;
	cutin "ep18_Suad_04.png",0;
	mes "[法庭]";
	mes "有...我們中間的叛徒嗎？";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米麗亞姆]";
	mes "說他躲藏而不是叛徒會更準確。從一開始，他就從來沒有站在我們這邊。";
	next;
	cutin "ep18_Suad_02.png",0;
	mes "[法庭]";
	mes "因此，從一開始，您幾乎被計劃中的騷亂陷入了困境嗎？";
	next;
	cutin "ra_gwoman.bmp",2;
	mes "[NI人]";
	mes "這不是時間。他們說他們也混在一起，因此我們必須首先接管兩支部隊。";
	next;
	mapannounce 'map_1nyr$, "beep--------", bc_map, 0xFF0000;
	cutin "ep18_Suad_04.png",0;
	mes "[法庭]";
	mes "這是什麼哨子？這不是我們的信號嗎？";
	next;
	cutin "",255;
	setnpcdisplay( instance_npcname("Temple Guard#dms802"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Temple Guard#dms812"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Temple Guard#dms822"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Temple Guard#dms832"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Temple Guard#dms842"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Angry Crowd#dms202"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Angry Crowd#dms212"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Angry Crowd#dms222"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Angry Crowd#dms232"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Angry Crowd#dms242"), 21308 );	// EP18_MD_HEARTHUNTER_A
	npctalk "現在？", instance_npcname("Angry Crowd#dms202");
	npctalk "現在！", instance_npcname("Temple Guard#dms832");
	mes "[人群]";
	mes "你為什麼要脫衣服？";
	next;
	disablenpc instance_npcname("Temple Guard#dms802");
	disablenpc instance_npcname("Temple Guard#dms812");
	disablenpc instance_npcname("Temple Guard#dms822");
	disablenpc instance_npcname("Temple Guard#dms832");
	disablenpc instance_npcname("Temple Guard#dms842");
	disablenpc instance_npcname("Angry Crowd#dms202");
	disablenpc instance_npcname("Angry Crowd#dms212");
	disablenpc instance_npcname("Angry Crowd#dms222");
	disablenpc instance_npcname("Angry Crowd#dms232");
	disablenpc instance_npcname("Angry Crowd#dms242");

	enablenpc instance_npcname("Heart Hunter#dms101");
	enablenpc instance_npcname("Heart Hunter#dms111");
	enablenpc instance_npcname("Heart Hunter#dms121");
	enablenpc instance_npcname("Heart Hunter#dms131");
	enablenpc instance_npcname("Heart Hunter#dms141");
	enablenpc instance_npcname("Heart Hunter#dms151");
	enablenpc instance_npcname("Heart Hunter#dms161");
	enablenpc instance_npcname("Heart Hunter#dms171");
	enablenpc instance_npcname("Heart Hunter#dms181");
	enablenpc instance_npcname("Heart Hunter#dms191");
	mes "[寺廟後衛]";
	mes "不要保持警惕！";
	next;
	mes "[人群]";
	mes "你在幹什麼？你在幹什麼？";
	next;
	npctalk "對不起。我沒有個人感情。", instance_npcname("Heart Hunter#dms101");
	npctalk "當你被告知解散時你就應該這樣做！", instance_npcname("Heart Hunter#dms121");
	npctalk "你還不知道發生了什麼事嗎？", instance_npcname("Heart Hunter#dms141");
	npctalk "什麼樣的女神才是女神？最好相信我！", instance_npcname("Heart Hunter#dms171");
	npctalk "怎麼樣，喜歡壓迫的滋味嗎？ ？", instance_npcname("Heart Hunter#dms191");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms101");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms111");
	specialeffect EF_M02, AREA, instance_npcname("Heart Hunter#dms121");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms131");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms141");
	specialeffect EF_M02, AREA, instance_npcname("Heart Hunter#dms151");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms161");
	specialeffect EF_M02, AREA, instance_npcname("Heart Hunter#dms171");
	specialeffect EF_M02, AREA, instance_npcname("Heart Hunter#dms181");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms191");
	mes "[人群]";
	mes "ahhhhhhhhhhhh！寺廟守衛抓住人！ ！ ！";
	next;
	mes "[寺廟後衛]";
	mes "這是一次騷亂！讓我們倒下！";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米麗亞姆]";
	mes "啊...太晚了... !!";
	next;
	cutin "ep18_Suad_02.png",0;
	mes "[法庭]";
	mes "您必須停止蠻力攻擊。";
	next;
	cutin "ra_gwoman.bmp",2;
	mes "[NI人]";
	mes "我會撤離人。";
	if ('nyr_main_step == 19) {
		'nyr_main_step = 20;
		donpcevent instance_npcname("nyr_step_10") + "::OnStart";
	}
	close3;
}

1@nyr,1,1,0	script	nyr_step_10	-1,{
	end;
OnStart:
	disablenpc instance_npcname("Suad#dms102");
	disablenpc instance_npcname("Miriam#dms801");
	disablenpc instance_npcname("Niren#dms201");
	disablenpc instance_npcname("Zhed#dms101");
	disablenpc instance_npcname("Temple Guard#dms801");
	disablenpc instance_npcname("Temple Guard#dms811");
	disablenpc instance_npcname("Temple Guard#dms821");
	disablenpc instance_npcname("Temple Guard#dms831");
	disablenpc instance_npcname("Temple Guard#dms841");
	disablenpc instance_npcname("Temple Guard#dms851");
	disablenpc instance_npcname("Temple Guard#dms861");
	disablenpc instance_npcname("Temple Guard#dms871");
	disablenpc instance_npcname("Temple Guard#dms881");
	disablenpc instance_npcname("Temple Guard#dms891");

	disablenpc instance_npcname("Angry Crowd#dms201");
	disablenpc instance_npcname("Angry Crowd#dms211");
	disablenpc instance_npcname("Angry Crowd#dms221");
	disablenpc instance_npcname("Angry Crowd#dms231");
	disablenpc instance_npcname("Angry Crowd#dms241");
	disablenpc instance_npcname("Angry Crowd#dms251");
	disablenpc instance_npcname("Angry Crowd#dms261");
	disablenpc instance_npcname("Angry Crowd#dms271");
	disablenpc instance_npcname("Angry Crowd#dms281");
	disablenpc instance_npcname("Angry Crowd#dms291");

	disablenpc instance_npcname("Heart Hunter#dms101");
	disablenpc instance_npcname("Heart Hunter#dms111");
	disablenpc instance_npcname("Heart Hunter#dms121");
	disablenpc instance_npcname("Heart Hunter#dms131");
	disablenpc instance_npcname("Heart Hunter#dms141");
	disablenpc instance_npcname("Heart Hunter#dms151");
	disablenpc instance_npcname("Heart Hunter#dms161");
	disablenpc instance_npcname("Heart Hunter#dms171");
	disablenpc instance_npcname("Heart Hunter#dms181");
	disablenpc instance_npcname("Heart Hunter#dms191");
	.@label$ = instance_npcname("nyr_step_10") + "::OnMobDead";
	monster 'map_1nyr$,123,168,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,118,168,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,113,165,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,114,171,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,128,170,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,115,176,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,120,174,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,125,175,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,126,177,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,128,172,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	end;
OnMobDead:
	if ('nyr_main_step != 20)
		end;
	if (mobcount('map_1nyr$, instance_npcname("nyr_step_10") + "::OnMobDead") < 1) {
		'nyr_main_step = 21;
		npctalk "Adventurer, are you safe?", instance_npcname("Miriam#dms801");
		enablenpc instance_npcname("Miriam#dms801");
	}
	end;
}

1@nyr,113,172,5	duplicate(dummy_npc)	Temple Guard#dms802	4_M_RASWORD
1@nyr,126,172,3	duplicate(dummy_npc)	Temple Guard#dms812	4_M_RASWORD
1@nyr,112,178,5	duplicate(dummy_npc)	Temple Guard#dms822	4_M_RASWORD
1@nyr,127,178,3	duplicate(dummy_npc)	Temple Guard#dms832	4_M_RASWORD
1@nyr,118,172,5	duplicate(dummy_npc)	Temple Guard#dms842	4_M_RASWORD
1@nyr,130,163,1	duplicate(dummy_npc)	Niren#dms201	4_F_MADAME
1@nyr,131,165,3	duplicate(dummy_npc)	Zhed#dms101	4_M_RACHOLD1

1@nyr,130,172,3	duplicate(dummy_npc)	Temple Guard#dms801	4_M_RASWORD
1@nyr,127,174,3	duplicate(dummy_npc)	Temple Guard#dms811	4_M_RASWORD
1@nyr,112,174,5	duplicate(dummy_npc)	Temple Guard#dms821	4_M_RASWORD
1@nyr,109,172,5	duplicate(dummy_npc)	Temple Guard#dms831	4_M_RASWORD
1@nyr,116,172,5	duplicate(dummy_npc)	Temple Guard#dms841	4_M_RASWORD
1@nyr,120,172,3	duplicate(dummy_npc)	Temple Guard#dms851	4_M_RASWORD
1@nyr,123,172,3	duplicate(dummy_npc)	Temple Guard#dms861	4_M_RASWORD
1@nyr,117,176,5	duplicate(dummy_npc)	Temple Guard#dms871	4_M_RASWORD
1@nyr,122,176,3	duplicate(dummy_npc)	Temple Guard#dms881	4_M_RASWORD
1@nyr,119,178,5	duplicate(dummy_npc)	Temple Guard#dms891	4_M_RASWORD

1@nyr,123,168,3	duplicate(dummy_npc)	Heart Hunter#dms101	EP18_MD_HEARTHUNTER_A
1@nyr,118,168,5	duplicate(dummy_npc)	Heart Hunter#dms111	EP18_MD_HEARTHUNTER_A
1@nyr,113,165,5	duplicate(dummy_npc)	Heart Hunter#dms121	EP18_MD_HEARTHUNTER_A
1@nyr,114,171,5	duplicate(dummy_npc)	Heart Hunter#dms131	EP18_MD_HEARTHUNTER_A
1@nyr,128,170,3	duplicate(dummy_npc)	Heart Hunter#dms141	EP18_MD_HEARTHUNTER_A
1@nyr,115,176,5	duplicate(dummy_npc)	Heart Hunter#dms151	EP18_MD_HEARTHUNTER_A
1@nyr,120,174,3	duplicate(dummy_npc)	Heart Hunter#dms161	EP18_MD_HEARTHUNTER_A
1@nyr,125,175,3	duplicate(dummy_npc)	Heart Hunter#dms171	EP18_MD_HEARTHUNTER_A
1@nyr,123,177,3	duplicate(dummy_npc)	Heart Hunter#dms181	EP18_MD_HEARTHUNTER_A
1@nyr,128,172,3	duplicate(dummy_npc)	Heart Hunter#dms191	EP18_MD_HEARTHUNTER_A

// Note: dms201 and dms231 on the same cells on official
1@nyr,109,167,7	duplicate(dummy_npc)	Angry Crowd#dms201	4_EP18_GW_MAN01
1@nyr,117,164,1	duplicate(dummy_npc)	Angry Crowd#dms211	4_EP18_GW_WOMAN01
1@nyr,109,167,7	duplicate(dummy_npc)	Angry Crowd#dms231	4_M_MIDDLE
1@nyr,112,166,1	duplicate(dummy_npc)	Angry Crowd#dms221	4_EP18_GW_MAN02
1@nyr,122,166,1	duplicate(dummy_npc)	Angry Crowd#dms241	4_EP18_GW_WOMAN02
1@nyr,115,166,7	duplicate(dummy_npc)	Angry Crowd#dms251	4_EP18_GW_MIDDLE01
1@nyr,120,167,1	duplicate(dummy_npc)	Angry Crowd#dms261	4_M_RACHMAN1
1@nyr,116,170,1	duplicate(dummy_npc)	Angry Crowd#dms271	4_EP18_GW_MIDDLE02
1@nyr,112,168,1	duplicate(dummy_npc)	Angry Crowd#dms281	4_F_SHABBY
1@nyr,124,171,1	duplicate(dummy_npc)	Angry Crowd#dms291	4_EP18_GW_WOMAN01

1@nyr,118,171,1	duplicate(dummy_npc)	Angry Crowd#dms202	4_M_RACHMAN2
1@nyr,127,166,7	duplicate(dummy_npc)	Angry Crowd#dms212	4_M_DESERT
1@nyr,125,168,7	duplicate(dummy_npc)	Angry Crowd#dms222	4_M_RACHMAN1
1@nyr,123,164,7	duplicate(dummy_npc)	Angry Crowd#dms232	4_M_MIDDLE1
1@nyr,127,169,7	duplicate(dummy_npc)	Angry Crowd#dms242	4_F_SHABBY




//-------------------------------------------------------------------------
// Daily quest
//-------------------------------------------------------------------------
1@nyr,153,145,0	warp	#qwpto01	1,7,1@nyr,146,145
1@nyr,91,33,0	warp	#qwpto03	1,7,1@nyr,86,33
1@nyr,120,181,0	script	#qwpto02	WARPNPC,7,1,{
	end;
OnTouch:
	if ('nyr_daily_step > 12 && isbegin_quest(17522) == 1)
		changequest 17522,17524;
	warp 'map_2nyr$,35,222;
	end;
}
1@nyr,88,146,0	warp	#areaw03	1,5,1@nyr,94,158
// 1@nyr,43,26,0	duplicate(dummy_npc)	#qwptora	WARPNPC,7,1	// unknown

// probably starter npcs
// 1@nyr,194,30,0	script	#mson101	HIDDEN_WARP_NPC,5,5
1@nyr,196,30,0	script	#qar101sw	HIDDEN_WARP_NPC,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 0)
		end;
	'nyr_daily_step = 1;
	disablenpc instance_npcname("#qar101sw");

	enablenpc instance_npcname("Temple Guard#qdms101");
	enablenpc instance_npcname("Temple Guard#qdms111");
	enablenpc instance_npcname("Temple Guard#qdms121");
	enablenpc instance_npcname("Temple Guard#qdms131");
	enablenpc instance_npcname("Temple Guard#qdms141");
	enablenpc instance_npcname("Temple Guard#qdms151");
	enablenpc instance_npcname("Temple Guard#qdms161");
	enablenpc instance_npcname("Temple Guard#qdms171");
	enablenpc instance_npcname("Temple Guard#qdms181");

	sleep 1000;	// note: player can walk
	npctalk "歡迎冒險家。感謝您加入我們這次掃蕩行動", instance_npcname("Temple Guard#qdms101");
	sleep 1500;
	npctalk "你們都聚集了嗎？", instance_npcname("Temple Guard#qdms101");
	sleep 1000;
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms111");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms121");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms131");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms141");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms151");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms161");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms171");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms181");
	sleep 1000;
	npctalk "那些‘背棄誓言、放棄侍奉女神一生的叛徒們竟然在這里胡鬧！", instance_npcname("Temple Guard#qdms101");
	sleep 1500;
	npctalk "將女神的意志施展在他們身上也是我們的使命！ ！ ！", instance_npcname("Temple Guard#qdms101");
	sleep 1500;
	npctalk "From here, three garden areas, one temple entrance area, and four barrels have been blocked, so clean them.", instance_npcname("Temple Guard#qdms101");
	sleep 1500;
	npctalk "去！ ！", instance_npcname("Temple Guard#qdms101");
	enablenpc instance_npcname("Temple Guard#qdms01");
	sleep 1500;

	disablenpc instance_npcname("Temple Guard#qdms101");
	disablenpc instance_npcname("Temple Guard#qdms111");
	disablenpc instance_npcname("Temple Guard#qdms121");
	disablenpc instance_npcname("Temple Guard#qdms131");
	disablenpc instance_npcname("Temple Guard#qdms141");
	disablenpc instance_npcname("Temple Guard#qdms151");
	disablenpc instance_npcname("Temple Guard#qdms161");
	disablenpc instance_npcname("Temple Guard#qdms171");
	disablenpc instance_npcname("Temple Guard#qdms181");
	end;
}

// Guards entrance daily
1@nyr,190,31,1	duplicate(dummy_npc)	Temple Guard#qdms101	4_M_RASWORD
1@nyr,186,31,5	duplicate(dummy_npc)	Temple Guard#qdms111	4_M_RASWORD
1@nyr,187,32,5	duplicate(dummy_npc)	Temple Guard#qdms121	4_M_RASWORD
1@nyr,188,33,5	duplicate(dummy_npc)	Temple Guard#qdms131	4_M_RASWORD
1@nyr,189,34,5	duplicate(dummy_npc)	Temple Guard#qdms141	4_M_RASWORD
1@nyr,185,32,5	duplicate(dummy_npc)	Temple Guard#qdms151	4_M_RASWORD
1@nyr,186,33,5	duplicate(dummy_npc)	Temple Guard#qdms161	4_M_RASWORD
1@nyr,187,34,5	duplicate(dummy_npc)	Temple Guard#qdms171	4_M_RASWORD
1@nyr,188,35,5	duplicate(dummy_npc)	Temple Guard#qdms181	4_M_RASWORD


// 1@nyr,120,173,0	duplicate(dummy_npc)	#qar201sw	HIDDEN_WARP_NPC,5,5
// 1@nyr,108,167,0	duplicate(dummy_npc)	#qmobg401	HIDDEN_WARP_NPC,5,5

// 1@nyr,165,32,0	duplicate(dummy_npc)	#qmobg101	HIDDEN_WARP_NPC,5,5
1@nyr,1,1,0	script	#qmobg101	-1,{
	end;
OnStart01:
	callsub( S_Call, 1, "Nobody can stop us!", "Temple Guard#qdms01", 165,45, 170,58 );	// basic routine to spawn the monsters
OnMobDead1:
	callsub( S_Next, 2, "There are still enemies in Area 1! Search!", "Temple Guard#qdms02" );	// basic routine to enable the next npcs

OnStart02:
	callsub( S_Call, 2, "We are stronger now!", "Temple Guard#qdms02", 159,114, 183,111, 186,122 );
OnMobDead2:
	callsub( S_Next, 3, "There are still enemies in Area 1! Search!", "Temple Guard#qdms03" );

OnStart03:
	callsub( S_Call, 3, "You're driving us like prey!! I can't stand it!", "Temple Guard#qdms03", 163,141, 164,132 );
OnMobDead3:
	callsub( S_Next, 4, "Clear Area 1! Move to Area 2!!", "Temple Guard#qdms21", "#qwpto01" );

OnStart21:
	callsub( S_Call, 4, "Do you know my heart?", "Temple Guard#qdms21", 137,124 );
OnMobDead4:
	callsub( S_Next, 5, "The magic enemy in Area 2 remains! Search for it!", "Temple Guard#qdms22" );

OnStart22:
	callsub(S_Call, 5, "You must avoid it!", "Temple Guard#qdms22", 114,111, 102,98, 108,78, 120,78, 126,110 );
OnMobDead5:
	callsub( S_Next, 6, "There are still enemies in Area 2! Search!", "Temple Guard#qdms23" );

OnStart23:
	callsub( S_Call, 6, "Do you think I'll just be beaten?", "Temple Guard#qdms23", 138,61, 130,47, 125,36, 105,47, 103,35 );
OnMobDead6:
	callsub( S_Next, 7, "Clear Area 2! Move to Area 3!!", "Temple Guard#qdms31", "#qwpto03" );

OnStart31:
	callsub( S_Call, 7, "Are we wrong??", "Temple Guard#qdms31", 74,39, 60,32, 54,47 );
OnMobDead7:
	callsub( S_Next, 8, "There are still enemies in Area 3! Search for it!", "Temple Guard#qdms32" );

OnStart32:
	callsub( S_Call, 8, "You must avoid it!!", "Temple Guard#qdms32", 62,61, 54,76, 73,97, 73,87 );
OnMobDead8:
	callsub( S_Next, 9, "There is another magical enemy in Area 3! Search for it!!", "Temple Guard#qdms33" );

OnStart33:
	callsub( S_Call, 9, "Ike!!!", "Temple Guard#qdms33", 55,111, 69,114, 54,122, 49,119, 64,141, 80,141 );
OnMobDead9:
	callsub( S_Next, 10, "Clear Area 3! Move to Area 4!", "Temple Guard#qdms41", "#areaw03" );

OnStart41:
	callsub( S_Call, 10, "It's really tough.", "Temple Guard#qdms41", 94,183, 80,180, 62,183 );
OnMobDead10:
	callsub( S_Next, 11, "There are still enemies in Area 4!", "Temple Guard#qdms42" );

OnStart42:
	callsub( S_Call, 11, "You must avoid it!", "Temple Guard#qdms42", 119,173, 146,181, 178,182 );
OnMobDead11:
	if ('nyr_daily_step != 12)
		end;
	if (mobcount('map_1nyr$, instance_npcname("#qmobg101") + "::OnMobDead11") > 0)
		end;
	mapannounce 'map_1nyr$, "All areas clear! Gather at the temple entrance!", bc_map, 0xFFCC;
	for ( .@i = 0; .@i < 9; ++.@i )
		enablenpc instance_npcname("Temple Guard#qdms1" + .@i + "2");
	end;

S_Next:	// basic routine to mapannounce and enable the npcs
	if ('nyr_daily_step != getarg(0))
		end;
	if (mobcount('map_1nyr$, instance_npcname("#qmobg101") + "::OnMobDead" + ('nyr_daily_step-1)) > 0)
		end;
	mapannounce 'map_1nyr$, getarg(1), bc_map, 0xFFCC;
	for ( .@i = 2; .@i < getargcount(); ++.@i )
		enablenpc instance_npcname( getarg(.@i) );
	end;

S_Call:	// basic routine to display the message and spawn the monsters
	.@num = getarg(0);
	if ('nyr_daily_step != .@num)
		end;
	'nyr_daily_step = .@num + 1;
	npctalk getarg(1), instance_npcname( getarg(2) );
	sleep 500;
	disablenpc instance_npcname( getarg(2) );
	getmapxy .@map$, .@x, .@y, BL_NPC, getarg(2);
	.@label$ = instance_npcname("#qmobg101") + "::OnMobDead" + .@num;
	areamonster 'map_1nyr$, .@x-2, .@y-2, .@x+2, .@y+2, "Abandoned Temple Guard",21311,1, .@label$;	// EP18_MD_GUARD_B
	for ( .@i = 3; .@i < getargcount(); .@i += 2 ) {
		if (rand(2))
			monster 'map_1nyr$, getarg(.@i), getarg(.@i+1),"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
		else
			monster 'map_1nyr$, getarg(.@i), getarg(.@i+1),"Traditional Shrine Guard",21311,1, .@label$;	// EP18_MD_GUARD_B
	}
	end;
}

1@nyr,165,32,5	script	Temple Guard#qdms01	4_M_RASWORD,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	.@string$ = replacestr( strnpcinfo(2), "qdms", "" );
	donpcevent instance_npcname("#qmobg101") + "::OnStart" + .@string$;
	end;
}
1@nyr,165,98,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms02	4_M_RASWORD,5,5
1@nyr,184,141,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms03	4_M_RASWORD,5,5
1@nyr,139,134,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms21	4_M_RASWORD,5,5
1@nyr,102,109,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms22	4_M_RASWORD,5,5
1@nyr,137,78,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms23	4_M_RASWORD,5,5
1@nyr,74,32,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms31	4_M_RASWORD,5,5
1@nyr,54,61,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms32	4_M_RASWORD,5,5
1@nyr,65,108,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms33	4_M_RASWORD,5,5
1@nyr,108,167,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms41	4_M_RASWORD,5,5
1@nyr,107,178,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms42	4_M_RASWORD,5,5

// Final map 1
1@nyr,119,175,3	script	Temple Guard#qdms102	4_M_RASWORD,2,2,{
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 12)
		end;
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms112");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms122");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms132");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms142");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms152");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms162");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms172");
	npctalk "是的！ ！", instance_npcname("Temple Guard#qdms182");

	mes "[寺廟後衛隊長]";
	mes "你做得很好！掃地將每天繼續！讓我們分手今天休息！";
	next;
	mes "[寺廟後衛隊長]";
	mes "冒險家，感謝您的幫助。";
	next;
	mes "[寺廟後衛隊長]";
	mes "我聽說您還參加了聖殿內部的一個單獨的掃蕩行動。所以，謝謝！";
	close2;
	if ('nyr_daily_step != 12)
		end;
	'nyr_daily_step = 13;
	enablenpc instance_npcname("#qwpto02");
	enablenpc instance_npcname("#2ar101sw");
	end;
}
1@nyr,116,171,7	duplicate(dummy_npc)	Temple Guard#qdms112	4_M_RASWORD
1@nyr,118,171,7	duplicate(dummy_npc)	Temple Guard#qdms122	4_M_RASWORD
1@nyr,120,171,1	duplicate(dummy_npc)	Temple Guard#qdms132	4_M_RASWORD
1@nyr,122,171,1	duplicate(dummy_npc)	Temple Guard#qdms142	4_M_RASWORD
1@nyr,116,173,7	duplicate(dummy_npc)	Temple Guard#qdms152	4_M_RASWORD
1@nyr,118,173,7	duplicate(dummy_npc)	Temple Guard#qdms162	4_M_RASWORD
1@nyr,120,173,1	duplicate(dummy_npc)	Temple Guard#qdms172	4_M_RASWORD
1@nyr,122,173,1	duplicate(dummy_npc)	Temple Guard#qdms182	4_M_RASWORD

// nowalk delimiter npcs
1@nyr,89,24,5	duplicate(dummy_npc)	#cell01	2_MONEMUS
1@nyr,89,37,5	duplicate(dummy_npc)	#cell02	2_MONEMUS
1@nyr,89,58,5	duplicate(dummy_npc)	#cell03	2_MONEMUS
1@nyr,89,65,5	duplicate(dummy_npc)	#cell04	2_MONEMUS
1@nyr,89,106,5	duplicate(dummy_npc)	#cell05	2_MONEMUS
1@nyr,89,113,5	duplicate(dummy_npc)	#cell06	2_MONEMUS
1@nyr,89,134,5	duplicate(dummy_npc)	#cell07	2_MONEMUS
1@nyr,89,153,5	duplicate(dummy_npc)	#cell08	2_MONEMUS
1@nyr,150,134,5	duplicate(dummy_npc)	#cell09	2_MONEMUS
1@nyr,150,153,5	duplicate(dummy_npc)	#cell10	2_MONEMUS
1@nyr,150,24,5	duplicate(dummy_npc)	#cell11	2_MONEMUS
1@nyr,150,37,5	duplicate(dummy_npc)	#cell12	2_MONEMUS
1@nyr,150,58,5	duplicate(dummy_npc)	#cell13	2_MONEMUS
1@nyr,150,65,5	duplicate(dummy_npc)	#cell14	2_MONEMUS
1@nyr,150,106,5	duplicate(dummy_npc)	#cell15	2_MONEMUS
1@nyr,150,113,5	duplicate(dummy_npc)	#cell66	2_MONEMUS

// 1@nyr,89,153,5	duplicate(dummy_npc)	#cell41	2_MONEMUS	// duplicate of 8
1@nyr,98,153,5	duplicate(dummy_npc)	#cell42	2_MONEMUS
1@nyr,141,153,5	duplicate(dummy_npc)	#cell51	2_MONEMUS


// map 2
2@nyr,35,200,0	script	#2ar101sw	HIDDEN_WARP_NPC,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 13)
		end;
	'nyr_daily_step = 14;
	for ( .@i = 0; .@i < 7; ++.@i )
		enablenpc instance_npcname("Temple Guard#2dms1" + .@i + "1");
	npctalk "這是這座寺廟的核心！", instance_npcname("Temple Guard#2dms101");
	sleep 2000;
	npctalk "Check all methods of facility, secure high entry, and deal with all who seek strength!", instance_npcname("Temple Guard#2dms101");
	sleep 2000;
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms111");
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms121");
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms131");
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms141");
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms151");
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms161");
	sleep 2000;
	npctalk "去！", instance_npcname("Temple Guard#2dms101");
	sleep 2000;
	for ( .@i = 1; .@i < 7; ++.@i )
		disablenpc instance_npcname("Temple Guard#2dms1" + .@i + "1");
	npctalk "Adventurer, thank you for participating in the sweeping operation!", instance_npcname("Temple Guard#2dms101");
	sleep 2000;
	npctalk "Adventurers, I would like to ask you for a separate mission besides dealing with the intruders.", instance_npcname("Temple Guard#2dms101");
	sleep 2000;
	npctalk "I will temporarily issue administrator rights to the leader of the party, so please set a new security number for the security facility every day.", instance_npcname("Temple Guard#2dms101");
	sleep 2000;
	'code = rand(1000,9999);
	npctalk "今天的安全號碼是" + 'code + "。請務必在確認庫和存儲為空後進行設置。", instance_npcname("Temple Guard#2dms101");
	sleep 2000;
	npctalk "那我們就去執行任務吧！", instance_npcname("Temple Guard#2dms101");
	enablenpc instance_npcname("Heart Hunter#2dms10");
	end;
}

2@nyr,35,187,7	script	Temple Guard#2dms101	4_M_RASWORD,{
	if ('code > 0)
		npctalk "忘記了您的安全號碼？今天的安全號碼是" + 'code + "。趕快！我很快就會加入你們。";
	end;
}

2@nyr,37,191,3	duplicate(dummy_npc)	Temple Guard#2dms111	4_M_RASWORD
2@nyr,35,191,3	duplicate(dummy_npc)	Temple Guard#2dms121	4_M_RASWORD
2@nyr,33,191,3	duplicate(dummy_npc)	Temple Guard#2dms131	4_M_RASWORD
2@nyr,33,189,5	duplicate(dummy_npc)	Temple Guard#2dms141	4_M_RASWORD
2@nyr,35,189,5	duplicate(dummy_npc)	Temple Guard#2dms151	4_M_RASWORD
2@nyr,37,189,5	duplicate(dummy_npc)	Temple Guard#2dms161	4_M_RASWORD


// mobs spawn npcs
2@nyr,1,1,0	script	#nyr_puri_mob_2	-1,{
	end;
OnStart10:
	callsub( S_Call, 14, "Ah! Surprise!", "Heart Hunter#2dms10" );
OnMobDead14:
	callsub( S_Next, 15, "There are still enemies in Area 1! Search for it!!", "Heart Hunter#2dms11" );

OnStart11:
	callsub( S_Call, 15, "What? Why are they doing this??", "Heart Hunter#2dms11" );
OnMobDead15:
	callsub( S_Next, 16, "There are still enemies in Area 1! Search for it!!", "Heart Hunter#2dms12" );

OnStart12:
	callsub( S_Call, 16, "Ike!!!", "Heart Hunter#2dms12" );
OnMobDead16:
	callsub( S_Next, 17, "Corridor clear near the library 1! Move up to library 1!", "Heart Hunter#2dms13", "#2mstep01" );

OnStart13:
	callsub( S_Call, 17, "Mayu! Annoying! Leave us alone!", "Heart Hunter#2dms13", 33,104, 31,79, 31,67, 18,81 );
OnMobDead17:
	callsub( S_Next, 18, "Library 1 clear! Waiting for Security reset", "#2mstep02" );

OnStart20:
	callsub( S_Call, 20, "Why are you so diligent!!", "Heart Hunter#2dms20" );
OnMobDead20:
	callsub( S_Next, 21, "There is a beautiful man in the second area! Search for it!!", "Heart Hunter#2dms21" );

OnStart21:
	callsub( S_Call, 21, "Leave us alone!", "Heart Hunter#2dms21" );
OnMobDead21:
	callsub( S_Next, 22, "Second area clear! 2 sets transferred!!", "Heart Hunter#2dms22", "#2mstep03" );

OnStart22:
	callsub( S_Call, 22, "If you just find that book...!! Who are you?", "Heart Hunter#2dms22", 94,62, 132,62, 156,48, 156,36, 132,17, 100,16 , 83,33, 91,44);
OnMobDead22:
	callsub( S_Next, 23, "Second area clear! Waiting for Security reset", "#2mstep04" );

OnStart30:
	callsub( S_Call, 25, "I'll just make it!!", "Heart Hunter#2dms30" );
OnMobDead25:
	callsub( S_Next, 26, "There are still enemies in Area 3, Search!", "Heart Hunter#2dms31" );

OnStart31:
	callsub( S_Call, 26, "Really persistent! Tired!", "Heart Hunter#2dms31" );
OnMobDead26:
	callsub( S_Next, 27, "Corridor clear near the Library 3! Enter Library 3!", "Heart Hunter#2dms32", "#2mstep05" );

OnStart32:
	callsub( S_Call, 27, "I need to go to the Mercer archive!!!", "Heart Hunter#2dms32", 195,99, 215,101, 192,80, 205,64, 214,57 );
OnMobDead27:
	callsub( S_Next, 28, "Library 3 clear! Waiting for security number reset", "#2mstep06" );

OnStart40:
	callsub( S_Call, 30, "I haven't gotten what I want yet!", "Heart Hunter#2dms40" );
OnMobDead30:
	callsub( S_Next, 31, "Central clear! Enter storage room!", "#2mstep07", "#2mstep08", "Heart Hunter#2dms41", "Heart Hunter#2dms42", "Heart Hunter#2dms43", "Heart Hunter#2dms44", "Heart Hunter#2dms45",
		"Heart Hunter#2dms46", "Heart Hunter#2dms47", "Heart Hunter#2dms48", "Heart Hunter#2dms49", "#2ar201sw" );

S_Next:
	if ('nyr_daily_step != getarg(0))
		end;
	if (mobcount('map_2nyr$, instance_npcname("#nyr_puri_mob_2") + "::OnMobDead" + ('nyr_daily_step-1)) > 0)
		end;
	mapannounce 'map_2nyr$, getarg(1), bc_map, 0xFFCC;
	for ( .@i = 2; .@i < getargcount(); ++.@i )
		enablenpc instance_npcname( getarg(.@i) );
	end;

S_Call:
	.@num = getarg(0);
	if ('nyr_daily_step != .@num)
		end;
	'nyr_daily_step = .@num + 1;
	npctalk getarg(1), instance_npcname( getarg(2) );
	sleep 500;
	disablenpc instance_npcname( getarg(2) );
	.@label$ = instance_npcname("#nyr_puri_mob_2") + "::OnMobDead" + .@num;
	if (getargcount() < 4) {
		getmapxy .@map$, .@x, .@y, BL_NPC, getarg(2);
		monster 'map_2nyr$, .@x, .@y,"Heart Hunter at the Villa",21312,1, .@label$;	// EP18_MD_HEARTHUNTER_R
	}
	else {
		for ( .@i = 3; .@i < getargcount(); .@i += 2 ) {
			monster 'map_2nyr$, getarg(.@i), getarg(.@i+1),"Heart Hunter at the Villa",21312,1, .@label$;	// EP18_MD_HEARTHUNTER_R
		}
	}
	end;

OnFinal:
	if ('nyr_daily_step != 32)
		end;
	if (mobcount('map_2nyr$, instance_npcname("#nyr_puri_mob_2") + "::OnFinal") > 0)
		end;
	mapannounce 'map_2nyr$, "Waiting for Vault number reset!", bc_map, 0xFFCC;
	disablenpc instance_npcname("#2mstep07");
	disablenpc instance_npcname("#2mstep08");
	enablenpc instance_npcname("#2mstep09");
	enablenpc instance_npcname("#2mstep10");
	end;
}

2@nyr,35,171,5	script	Heart Hunter#2dms10	EP18_MD_HEARTHUNTER_R,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	.@string$ = replacestr( strnpcinfo(2), "2dms", "" );
	donpcevent instance_npcname("#nyr_puri_mob_2") + "::OnStart" + .@string$;
	end;
}
2@nyr,36,146,5	duplicate(Heart Hunter#2dms10)	Heart Hunter#2dms11	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,64,131,5	duplicate(Heart Hunter#2dms10)	Heart Hunter#2dms12	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,42,104,5	duplicate(Heart Hunter#2dms10)	Heart Hunter#2dms13	EP18_MD_HEARTHUNTER_R,5,5

2@nyr,69,103,5	duplicate(Heart Hunter#2dms10)	Heart Hunter#2dms20	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,106,78,5	duplicate(Heart Hunter#2dms10)	Heart Hunter#2dms21	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,94,62,5	duplicate(Heart Hunter#2dms10)	Heart Hunter#2dms22	EP18_MD_HEARTHUNTER_R,5,5

2@nyr,129,75,5	duplicate(Heart Hunter#2dms10)	Heart Hunter#2dms30	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,158,104,5	duplicate(Heart Hunter#2dms10)	Heart Hunter#2dms31	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,195,99,5	duplicate(Heart Hunter#2dms10)	Heart Hunter#2dms32	EP18_MD_HEARTHUNTER_R,5,5

2@nyr,174,109,5	duplicate(Heart Hunter#2dms10)	Heart Hunter#2dms40	EP18_MD_HEARTHUNTER_R,5,5


// final battle
2@nyr,115,177,3	script	Heart Hunter#2dms41	EP18_MD_HEARTHUNTER_R,5,5,{
	end;
OnTouch:
	npctalk "呃~我覺得肉來了~";
	end;
}

2@nyr,126,174,5	script	Heart Hunter#2dms42	EP18_MD_HEARTHUNTER_R,5,5,{
	end;
OnTouch:
	npctalk "你就坐了！ ！";
	end;
}

2@nyr,117,207,1	duplicate(dummy_npc)	Heart Hunter#2dms43	EP18_MD_HEARTHUNTER_R,2,2
2@nyr,115,206,7	duplicate(dummy_npc)	Heart Hunter#2dms44	EP18_MD_HEARTHUNTER_R,2,2
2@nyr,119,206,1	duplicate(dummy_npc)	Heart Hunter#2dms45	EP18_MD_HEARTHUNTER_R,2,2
2@nyr,129,199,5	duplicate(dummy_npc)	Heart Hunter#2dms46	EP18_MD_HEARTHUNTER_R,2,2
2@nyr,113,194,3	duplicate(dummy_npc)	Heart Hunter#2dms47	EP18_MD_HEARTHUNTER_R,2,2
2@nyr,111,209,5	duplicate(dummy_npc)	Heart Hunter#2dms48	EP18_MD_HEARTHUNTER_R,2,2
2@nyr,112,206,5	duplicate(dummy_npc)	Heart Hunter#2dms49	EP18_MD_HEARTHUNTER_R,2,2
2@nyr,115,201,5	duplicate(dummy_npc)	Heart Hunter#2dms50	EP17_1_BELLARE1

2@nyr,118,200,0	script	#2ar201sw	HIDDEN_WARP_NPC,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 31)
		end;
	'nyr_daily_step = 32;
	disablenpc();
	enablenpc instance_npcname("Heart Hunter#2dms50");
	emotion ET_QUESTION, getnpcid(0,instance_npcname("Heart Hunter#2dms50"));
	sleep 500;
	npctalk "什麼？闖入者來了？", instance_npcname("Heart Hunter#2dms50");
	sleep 2000;
	npctalk "What else are you doing, so no one can come in? Calm down!", instance_npcname("Heart Hunter#2dms50");
	sleep 2000;
	npctalk "嗯~我醉了~我醉了我的心魔~", instance_npcname("Heart Hunter#2dms48");
	sleep 2000;
	npctalk "這不是國家唯一允許的魔法嗎？", instance_npcname("Heart Hunter#2dms48");
	npctalk "What do you mean? This is not even allowed by the state, did you forget?", instance_npcname("Heart Hunter#2dms44");
	sleep 2000;
	npctalk "Oh, that's right. Were we trespassing?", instance_npcname("Heart Hunter#2dms49");
	sleep 200;
	npctalk "是因為味道非法才更令人興奮嗎？", instance_npcname("Heart Hunter#2dms48");
	npctalk "Hey! This is a bit strange, isn't the heart's magic power not fully released even after finishing it?", instance_npcname("Heart Hunter#2dms43");
	npctalk "所以遠離它吧！我會嘗試一下！", instance_npcname("Heart Hunter#2dms45");
	sleep 2000;
	npctalk "What? So, what is this thrill that flows through my body right now?", instance_npcname("Heart Hunter#2dms48");
	sleep 2000;
	npctalk "仔細看。可能存在短路。", instance_npcname("Heart Hunter#2dms49");
	npctalk "Hey, it's exciting once in a while.", instance_npcname("Heart Hunter#2dms48");
	npctalk "你說你以前看到過你肩膀上的控制裝置？只相信你嗎？", instance_npcname("Heart Hunter#2dms50");
	sleep 1000;
	npctalk "That's... Wait, it says security number mismatch?", instance_npcname("Heart Hunter#2dms43");
	sleep 2000;
	npctalk "安全碼不匹配？嗯……好像和這裡的冒險者有關係吧？不是嗎？", instance_npcname("Heart Hunter#2dms50");
	sleep 2000;
	npctalk "您可以輸入門票安全碼嗎？那麼我們都會非常高興。", instance_npcname("Heart Hunter#2dms50");
	sleep 2000;
	npctalk "Get out of the way, machines say you have to hit them to hear them!", instance_npcname("Heart Hunter#2dms45");
	npctalk "嘿！誰這樣對待機器？", instance_npcname("Heart Hunter#2dms43");
	specialeffect EF_HIT1, AREA, instance_npcname("Heart Hunter#2dms45");
	sleep 2000;
	npctalk "啊！ ！ ！突然更興奮了！ ！這是你的心情嗎？", instance_npcname("Heart Hunter#2dms48");
	npctalk "看來你是對的！男孩突然發光了！", instance_npcname("Heart Hunter#2dms44");
	specialeffect EF_MAGICALATTHIT, AREA, instance_npcname("Heart Hunter#2dms48");
	sleep 2000;
	npctalk "啊啊啊！ ！ ！", instance_npcname("Heart Hunter#2dms48");
	npctalk "啊！ ！他很酷！", instance_npcname("Heart Hunter#2dms44");
	npctalk "為什麼只有他……？有什麼奇怪的嗎？", instance_npcname("Heart Hunter#2dms43");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms48");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms48");
	sleep 2000;
	npctalk "什麼...？", instance_npcname("Heart Hunter#2dms43");
	npctalk "這是什麼？", instance_npcname("Heart Hunter#2dms44");
	npctalk "壞機器你也該敲一下！", instance_npcname("Heart Hunter#2dms45");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms43");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms44");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms45");
	sleep 2000;
	npctalk "我也觸電了嗎？我長得不太好看？", instance_npcname("Heart Hunter#2dms49");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms43");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms44");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms45");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms49");
	sleep 2000;
	npctalk "It's not that I succeeded, look, can we all resonate with the heart?", instance_npcname("Heart Hunter#2dms45");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms49");
	sleep 200;
	npctalk "...", instance_npcname("Heart Hunter#2dms48");
	sleep 2000;
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms41");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms42");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms46");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms47");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms50");
	npctalk "What is it, I can't get the heart's magic power out, but it resonates well. Then I should try this power?", instance_npcname("Heart Hunter#2dms50");
	npctalk "There is an adventurer, that's perfect.", instance_npcname("Heart Hunter#2dms49");
	npctalk "Okay. Otherwise, it would have been obvious to us all, right?", instance_npcname("Heart Hunter#2dms45");
	npctalk "啊!我去了弗龍特拉並看到了這一點。大家都在打雞蛋嗎？", instance_npcname("Heart Hunter#2dms44");
	sleep 2000;
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms41");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms42");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms46");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms47");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms50");
	npctalk "I don't have any personal feelings, but if we let it go like this, we'll be in trouble.", instance_npcname("Heart Hunter#2dms50");
	sleep 2000;
	npctalk "Things that would have been nice if we just passed by without knowing, there is nothing we can do about it, bye.", instance_npcname("Heart Hunter#2dms50");

	for ( .@i = 41; .@i < 51; ++.@i ) {
		hideonnpc instance_npcname("Heart Hunter#2dms" + .@i );
		disablenpc instance_npcname("Heart Hunter#2dms" + .@i );
	}

	.@label$ = instance_npcname("#nyr_puri_mob_2") + "::OnFinal";
	monster 'map_2nyr$,122,194,"Heart Hunter at the Villa",21312,1, .@label$;	// EP18_MD_HEARTHUNTER_R
	monster 'map_2nyr$,118,196,"Heart Hunter at the Villa",21312,1, .@label$;
	monster 'map_2nyr$,117,207,"Heart Hunter at the Villa",21312,1, .@label$;
	monster 'map_2nyr$,115,206,"Heart Hunter at the Villa",21312,1, .@label$;
	monster 'map_2nyr$,119,206,"Heart Hunter at the Villa",21312,1, .@label$;
	monster 'map_2nyr$,113,194,"Heart Hunter at the Villa",21312,1, .@label$;
	monster 'map_2nyr$,111,209,"Heart Hunter at the Villa",21312,1, .@label$;
	monster 'map_2nyr$,112,206,"Heart Hunter at the Villa",21312,1, .@label$;
	monster 'map_2nyr$,115,201,"Heart Hunter at the Villa",21313,1, .@label$;	// EP18_MD_HEARTHUNTER_F
	end;
}


// warp npcs
2@nyr,56,104,0	warp	#2mstep01	1,1,2@nyr,49,104

2@nyr,49,55,0	script	#2mstep02	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,53,55;
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 18)
		end;
	'nyr_daily_step = 19;
	disablenpc instance_npcname("#2mstep01");
	enablenpc instance_npcname("Security Device#2dms10");
	end;
}

2@nyr,119,71,0	warp	#2mstep03	1,1,2@nyr,119,65

2@nyr,119,66,0	script	#2mstep04	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,117,73;
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 23)
		end;
	'nyr_daily_step = 24;
	disablenpc instance_npcname("#2mstep03");
	enablenpc instance_npcname("Security Device#2dms20");
	end;
}

2@nyr,183,104,0	warp	#2mstep05	1,1,2@nyr,190,104

2@nyr,186,104,0	script	#2mstep06	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,180,104;
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 28)
		end;
	'nyr_daily_step = 29;
	disablenpc instance_npcname("#2mstep05");
	enablenpc instance_npcname("Security Device#2dms30");
	end;
}

2@nyr,120,123,0	script	#2mstep07	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,120,126;
	navigateto("2@nyr",120,137);
	end;
}

2@nyr,120,137,0	script	#2mstep08	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,120,147;
	navigateto("2@nyr",120,197);
	end;
}

2@nyr,120,141,0	script	#2mstep09	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,120,134;
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 32)
		end;
	'nyr_daily_step = 33;
	enablenpc instance_npcname("Security Device#2dms40");
	end;
}

2@nyr,151,131,0	script	#2mstep10	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,159,131;
	navigateto("2@nyr",203,220);
	end;
}

2@nyr,203,220,0	script	#2mstep11	WARPNPC,1,1,{
	end;
OnTouch:
	if ('nyr_daily_step == 35 && isbegin_quest(17523) == 1)
		changequest 17523,17526;
	warp "rachel",167,240;
	end;
}


// Code
2@nyr,51,57,5	script	Security Device#2dms10	4_POINT_BLUE,5,5,{
	if (is_party_leader() == false)
		end;
	switch( atoi( replacestr( strnpcinfo(2), "2dms", "" ) ) ) {
	case 10:
		.@step = 19;
		.@mes$ = "The first library security number has been reset.";
		.@enable$ = "Heart Hunter#2dms20";
		setarray .@xy[0],119,71;
		break;
	case 20:
		.@step = 24;
		.@mes$ = "Security number for the second library has been reset.";
		.@enable$ = "Heart Hunter#2dms30";
		setarray .@xy[0],183,104;
		break;
	case 30:
		.@step = 29;
		.@mes$ = "The third library security number has been reset.";
		.@enable$ = "Heart Hunter#2dms40";
		setarray .@xy[0],120,123;
		break;
	default:
		end;
	}
	if ('nyr_daily_step != .@step)
		end;
	mes "等待安全代碼重置。請輸入新的安全代碼。";
	next;
	input .@num;
	if (.@num != 'code) {
		mes "取消輸入";
		close;
	}
	mes .@mes$;
	if ('nyr_daily_step == .@step) {
		'nyr_daily_step = .@step + 1;
		enablenpc instance_npcname( .@enable$ );
	}
	navigateto("2@nyr",.@xy[0],.@xy[1]);
	close;
OnTouch:
	npctalk "等待安全號碼重置";
	end;
}
2@nyr,115,69,5	duplicate(Security Device#2dms10)	Security Device#2dms20	4_POINT_BLUE,5,5
2@nyr,184,100,5	duplicate(Security Device#2dms10)	Security Device#2dms30	4_POINT_BLUE,5,5

2@nyr,124,138,5	script	Security Device#2dms40	4_POINT_BLUE,5,5,{
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 33)
		end;
	mes "等待安全代碼重置。請輸入新的安全代碼。";
	next;
	input .@num;
	if (.@num != 'code) {
		mes "取消輸入";
		close;
	}
	mes "更衣室的安全號碼已重置。";
	if ('nyr_daily_step == 33) {
		'nyr_daily_step = 34;
		enablenpc instance_npcname("#2mstep10");
		enablenpc instance_npcname("#2mstep11");
		enablenpc instance_npcname("Temple Guard#2dms201");
		enablenpc instance_npcname("Temple Guard#2dms211");
		enablenpc instance_npcname("Temple Guard#2dms221");
		enablenpc instance_npcname("Temple Guard#2dms231");
		enablenpc instance_npcname("Temple Guard#2dms241");
		enablenpc instance_npcname("Temple Guard#2dms251");
		enablenpc instance_npcname("Temple Guard#2dms261");
		enablenpc instance_npcname("#msnavi01");
		mapannounce 'map_2nyr$, "Do you think the crowd will give up because of the delay? The taste of baboons dried up? Leave it!", bc_map, 0xFFCC;
		sleep2 1000;
		mapannounce 'map_2nyr$, "Look, the whole area screams towards the clearer power outlets!", bc_map, 0xFFCC;
	}
	navigateto("2@nyr",151,131);
	close;
OnTouch:
	npctalk "等待安全號碼重置。";
	end;
}

2@nyr,174,135,5	script	Temple Guard#2dms201	4_M_RASWORD,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 34)
		end;
	'nyr_daily_step = 35;
	npctalk "大家辛苦了！";
	sleep 2000;
	npctalk "每天只有少數人應該淨化寺廟！";
	sleep 2000;
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms211");
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms221");
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms231");
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms241");
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms251");
	npctalk "是的！ ！", instance_npcname("Temple Guard#2dms261");
	// npctalk "全部解散下！";
	sleep 2000;
	npctalk "我會再做一次，因為寺廟有很多麻煩。";
	end;
}

2@nyr,177,134,1	duplicate(dummy_npc)	Temple Guard#2dms211	4_M_RASWORD,3,0
2@nyr,176,133,1	duplicate(dummy_npc)	Temple Guard#2dms221	4_M_RASWORD
2@nyr,175,132,1	duplicate(dummy_npc)	Temple Guard#2dms231	4_M_RASWORD
2@nyr,178,133,1	duplicate(dummy_npc)	Temple Guard#2dms241	4_M_RASWORD
2@nyr,177,132,1	duplicate(dummy_npc)	Temple Guard#2dms251	4_M_RASWORD
2@nyr,176,131,1	duplicate(dummy_npc)	Temple Guard#2dms261	4_M_RASWORD

// 2@nyr,179,131,0	duplicate(dummy_npc)	#msnavi01	WARPNPC,3,3
2@nyr,179,131,0	script	#msnavi01	HIDDEN_WARP_NPC,3,3,{
	end;
OnTouch_:
	navigateto("2@nyr",203,220);
	end;
}
